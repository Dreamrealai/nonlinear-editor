
> nonlinear-editor@0.1.0 test
> jest

FAIL __tests__/api/projects/create.test.ts
  ● POST /api/projects › Authentication › should return 401 when user is not authenticated

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:76:34)

  ● POST /api/projects › Authentication › should return 401 when auth error occurs

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:93:34)

  ● POST /api/projects › Success Cases › should create a project with custom title

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:113:34)

  ● POST /api/projects › Success Cases › should create a project with default title when no title provided

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:140:34)

  ● POST /api/projects › Success Cases › should create a project with empty timeline state

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:162:34)

  ● POST /api/projects › Error Handling › should return 500 when database insert fails

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:180:34)

  ● POST /api/projects › Error Handling › should return 500 when unexpected error occurs

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:198:34)

  ● POST /api/projects › Error Handling › should handle malformed JSON body

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:213:34)

  ● POST /api/projects › Data Validation › should accept empty title and use default

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:233:34)

  ● POST /api/projects › Data Validation › should trim whitespace from title

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:256:34)

  ● POST /api/projects › Data Validation › should accept very long titles

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:275:34)

  ● POST /api/projects › Response Format › should return complete project object

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:297:34)

  ● POST /api/projects › Response Format › should return correct content-type header

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:318:34)

  ● POST /api/projects › Database Interactions › should call database methods in correct order

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:335:17)

  ● POST /api/projects › Database Interactions › should use select().single() chain

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:353:17)

FAIL __tests__/api/assets/upload.test.ts
  ● POST /api/assets/upload › Input Validation › should return 400 when no file provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      93 |       const response = await POST(mockRequest);
      94 |
    > 95 |       expect(response.status).toBe(400);
         |                               ^
      96 |       const data = await response.json();
      97 |       expect(data.error).toBe('No file provided');
      98 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:95:31)

  ● POST /api/assets/upload › Input Validation › should return 400 when no projectId provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      111 |       const response = await POST(mockRequest);
      112 |
    > 113 |       expect(response.status).toBe(400);
          |                               ^
      114 |       const data = await response.json();
      115 |       expect(data.error).toBe('Project ID required');
      116 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:113:31)

  ● POST /api/assets/upload › Input Validation › should return 400 when file exceeds size limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      140 |       const response = await POST(mockRequest);
      141 |
    > 142 |       expect(response.status).toBe(400);
          |                               ^
      143 |       const data = await response.json();
      144 |       expect(data.error).toBe('File too large');
      145 |       expect(data.details).toContain('100MB');

      at Object.toBe (__tests__/api/assets/upload.test.ts:142:31)

  ● POST /api/assets/upload › Input Validation › should return 400 for invalid image MIME type

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      162 |       const response = await POST(mockRequest);
      163 |
    > 164 |       expect(response.status).toBe(400);
          |                               ^
      165 |       const data = await response.json();
      166 |       expect(data.error).toBe('Invalid file type');
      167 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:164:31)

  ● POST /api/assets/upload › Input Validation › should accept valid image MIME types

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      193 |
      194 |         const response = await POST(mockRequest);
    > 195 |         expect(response.status).toBe(200);
          |                                 ^
      196 |       }
      197 |     });
      198 |

      at Object.toBe (__tests__/api/assets/upload.test.ts:195:33)

  ● POST /api/assets/upload › Input Validation › should accept valid video MIME types

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      224 |
      225 |         const response = await POST(mockRequest);
    > 226 |         expect(response.status).toBe(200);
          |                                 ^
      227 |       }
      228 |     });
      229 |   });

      at Object.toBe (__tests__/api/assets/upload.test.ts:226:33)

  ● POST /api/assets/upload › Project Authorization › should return 404 when project not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 500

      251 |       const response = await POST(mockRequest);
      252 |
    > 253 |       expect(response.status).toBe(404);
          |                               ^
      254 |       const data = await response.json();
      255 |       expect(data.error).toContain('not found');
      256 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:253:31)

  ● POST /api/assets/upload › Project Authorization › should return 404 when user does not own project

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 500

      280 |       const response = await POST(mockRequest);
      281 |
    > 282 |       expect(response.status).toBe(404);
          |                               ^
      283 |     });
      284 |
      285 |     it('should verify project ownership with user_id', async () => {

      at Object.toBe (__tests__/api/assets/upload.test.ts:282:31)

  ● POST /api/assets/upload › Project Authorization › should verify project ownership with user_id

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "id", "test-project-id"

    Number of calls: 0

      307 |       await POST(mockRequest);
      308 |
    > 309 |       expect(mockSupabase.eq).toHaveBeenCalledWith('id', 'test-project-id');
          |                               ^
      310 |       expect(mockSupabase.eq).toHaveBeenCalledWith('user_id', mockUser.id);
      311 |     });
      312 |   });

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:309:31)

  ● POST /api/assets/upload › File Upload Success › should upload file and create asset record

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      337 |       const response = await POST(mockRequest);
      338 |
    > 339 |       expect(response.status).toBe(200);
          |                               ^
      340 |       expect(mockSupabase.storage.upload).toHaveBeenCalled();
      341 |       expect(mockSupabase.insert).toHaveBeenCalledWith(
      342 |         expect.objectContaining({

      at Object.toBe (__tests__/api/assets/upload.test.ts:339:31)

  ● POST /api/assets/upload › File Upload Success › should generate unique filename with UUID

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringMatching /mock-uuid-123\./, Any<Buffer>, Any<Object>

    Number of calls: 0

      374 |       await POST(mockRequest);
      375 |
    > 376 |       expect(mockSupabase.storage.upload).toHaveBeenCalledWith(
          |                                           ^
      377 |         expect.stringMatching(/mock-uuid-123\./),
      378 |         expect.any(Buffer),
      379 |         expect.any(Object)

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:376:43)

  ● POST /api/assets/upload › File Upload Success › should organize files in correct folder structure

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "test-user-id/test-project-id/image/", Any<Buffer>, Any<Object>

    Number of calls: 0

      406 |       await POST(mockRequest);
      407 |
    > 408 |       expect(mockSupabase.storage.upload).toHaveBeenCalledWith(
          |                                           ^
      409 |         expect.stringContaining(`${mockUser.id}/test-project-id/image/`),
      410 |         expect.any(Buffer),
      411 |         expect.any(Object)

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:408:43)

  ● POST /api/assets/upload › File Upload Success › should return asset information in response

    expect(received).toHaveProperty(path)

    Expected path: "assetId"
    Received path: []

    Received value: {"error": "(0 , _supabase.isSupabaseServiceConfigured) is not a function"}

      438 |       const data = await response.json();
      439 |
    > 440 |       expect(data).toHaveProperty('assetId');
          |                    ^
      441 |       expect(data).toHaveProperty('storageUrl');
      442 |       expect(data).toHaveProperty('publicUrl');
      443 |       expect(data).toHaveProperty('success', true);

      at Object.toHaveProperty (__tests__/api/assets/upload.test.ts:440:20)

  ● POST /api/assets/upload › Error Handling › should return 500 when storage upload fails

    expect(received).toBe(expected) // Object.is equality

    Expected: "Storage quota exceeded"
    Received: "(0 , _supabase.isSupabaseServiceConfigured) is not a function"

      470 |       expect(response.status).toBe(500);
      471 |       const data = await response.json();
    > 472 |       expect(data.error).toBe('Storage quota exceeded');
          |                          ^
      473 |     });
      474 |
      475 |     it('should delete uploaded file when database insert fails', async () => {

      at Object.toBe (__tests__/api/assets/upload.test.ts:472:26)

  ● POST /api/assets/upload › Error Handling › should delete uploaded file when database insert fails

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      504 |
      505 |       expect(response.status).toBe(500);
    > 506 |       expect(mockSupabase.storage.remove).toHaveBeenCalled();
          |                                           ^
      507 |     });
      508 |
      509 |     it('should handle unexpected errors', async () => {

      at Object.toHaveBeenCalled (__tests__/api/assets/upload.test.ts:506:43)

  ● POST /api/assets/upload › Error Handling › should handle unexpected errors

    expect(received).toBe(expected) // Object.is equality

    Expected: "Internal server error"
    Received: "(0 , _supabase.isSupabaseServiceConfigured) is not a function"

      532 |       expect(response.status).toBe(500);
      533 |       const data = await response.json();
    > 534 |       expect(data.error).toBe('Internal server error');
          |                          ^
      535 |     });
      536 |   });
      537 |

      at Object.toBe (__tests__/api/assets/upload.test.ts:534:26)

  ● POST /api/assets/upload › Activity History › should log upload to activity history

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"activity_type": "image_upload", "project_id": "test-project-id", "user_id": "test-user-id"}

    Number of calls: 0

      561 |       await POST(mockRequest);
      562 |
    > 563 |       expect(mockSupabase.insert).toHaveBeenCalledWith(
          |                                   ^
      564 |         expect.objectContaining({
      565 |           activity_type: 'image_upload',
      566 |           user_id: mockUser.id,

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:563:35)

FAIL __tests__/api/video/generate.test.ts
  ● POST /api/video/generate › Project Ownership Verification › should return 404 when project not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      246 |       const response = await POST(mockRequest);
      247 |
    > 248 |       expect(response.status).toBe(404);
          |                               ^
      249 |     });
      250 |
      251 |     it('should return 403 when user does not own project', async () => {

      at Object.toBe (__tests__/api/video/generate.test.ts:248:31)

  ● POST /api/video/generate › Project Ownership Verification › should return 403 when user does not own project

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

      268 |       const response = await POST(mockRequest);
      269 |
    > 270 |       expect(response.status).toBe(403);
          |                               ^
      271 |     });
      272 |   });
      273 |

      at Object.toBe (__tests__/api/video/generate.test.ts:270:31)

  ● POST /api/video/generate › Video Generation - Google Veo › should generate video with Veo for Google models

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      294 |       const response = await POST(mockRequest);
      295 |
    > 296 |       expect(response.status).toBe(200);
          |                               ^
      297 |       const data = await response.json();
      298 |       expect(data.operationName).toBe('operations/veo-123');
      299 |       expect(data.status).toBe('processing');

      at Object.toBe (__tests__/api/video/generate.test.ts:296:31)

  ● POST /api/video/generate › Video Generation - Google Veo › should pass all Veo parameters correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"compressionQuality": "high", "enhancePrompt": true, "generateAudio": true, "model": "veo-3.1-generate-preview", "negativePrompt": "blurry, low quality", "personGeneration": true, "prompt": "Test video", "sampleCount": 2, "seed": 12345}

    Number of calls: 0

      337 |       await POST(mockRequest);
      338 |
    > 339 |       expect(generateVideo).toHaveBeenCalledWith(
          |                             ^
      340 |         expect.objectContaining({
      341 |           prompt: 'Test video',
      342 |           model: 'veo-3.1-generate-preview',

      at Object.toHaveBeenCalledWith (__tests__/api/video/generate.test.ts:339:29)

  ● POST /api/video/generate › Video Generation - FAL Models › should use FAL for Seedance model

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      376 |       const response = await POST(mockRequest);
      377 |
    > 378 |       expect(response.status).toBe(200);
          |                               ^
      379 |       const data = await response.json();
      380 |       expect(data.operationName).toBe('fal:seedance-1.0-pro:fal-request-123');
      381 |       expect(generateFalVideo).toHaveBeenCalled();

      at Object.toBe (__tests__/api/video/generate.test.ts:378:31)

  ● POST /api/video/generate › Video Generation - FAL Models › should use FAL for MiniMax model

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      404 |       const response = await POST(mockRequest);
      405 |
    > 406 |       expect(response.status).toBe(200);
          |                               ^
      407 |       const data = await response.json();
      408 |       expect(data.operationName).toContain('minimax-hailuo-02-pro');
      409 |     });

      at Object.toBe (__tests__/api/video/generate.test.ts:406:31)

  ● POST /api/video/generate › Image-to-Video Generation › should generate video from image asset

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"auth": {"getUser": [Function mockConstructor], "signOut": [Function mockConstructor]}, "channel": [Function mockConstructor], "delete": [Function mockConstructor], "eq": [Function mockConstructor], "from": [Function mockConstructor], "insert": [Function mockConstructor], "limit": [Function mockConstructor], "maybeSingle": [Function mockConstructor], "neq": [Function mockConstructor], "order": [Function mockConstructor], "removeChannel": [Function mockConstructor], "select": [Function mockConstructor], "single": [Function mockConstructor], "storage": {"createSignedUrl": [Function mockConstructor], "from": [Function mockConstructor], "getPublicUrl": [Function mockConstructor], "remove": [Function mockConstructor], "upload": [Function mockConstructor]}, "update": [Function mockConstructor]}, "image-asset-id", Any<String>

    Number of calls: 0

      449 |       await POST(mockRequest);
      450 |
    > 451 |       expect(verifyAssetOwnership).toHaveBeenCalledWith(
          |                                    ^
      452 |         mockSupabase,
      453 |         'image-asset-id',
      454 |         expect.any(String)

      at Object.toHaveBeenCalledWith (__tests__/api/video/generate.test.ts:451:36)

  ● POST /api/video/generate › Image-to-Video Generation › should return 404 when image asset not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      485 |       const response = await POST(mockRequest);
      486 |
    > 487 |       expect(response.status).toBe(404);
          |                               ^
      488 |     });
      489 |   });
      490 |

      at Object.toBe (__tests__/api/video/generate.test.ts:487:31)

  ● POST /api/video/generate › Error Handling › should return 500 when video generation fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

      509 |       const response = await POST(mockRequest);
      510 |
    > 511 |       expect(response.status).toBe(500);
          |                               ^
      512 |       const data = await response.json();
      513 |       expect(data.error).toBe('API error');
      514 |     });

      at Object.toBe (__tests__/api/video/generate.test.ts:511:31)

  ● POST /api/video/generate › Error Handling › should handle malformed JSON body

    SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
        at JSON.parse (<anonymous>)

      at parseJSONFromBytes (node_modules/undici/lib/web/fetch/body.js:504:15)
      at successSteps (node_modules/undici/lib/web/fetch/body.js:465:23)
      at readAllBytes (node_modules/undici/lib/web/fetch/util.js:1030:9)

  ● POST /api/video/generate › Response Format › should return operationName and status

    expect(received).toHaveProperty(path)

    Expected path: "operationName"
    Received path: []

    Received value: {"error": "Prompt is required", "field": "prompt"}

      549 |       const data = await response.json();
      550 |
    > 551 |       expect(data).toHaveProperty('operationName');
          |                    ^
      552 |       expect(data).toHaveProperty('status', 'processing');
      553 |       expect(data).toHaveProperty('message');
      554 |     });

      at Object.toHaveProperty (__tests__/api/video/generate.test.ts:551:20)

FAIL __tests__/api/video/upscale.test.ts
  ● POST /api/video/upscale › Authentication › should return 401 when user is not authenticated

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 400

       98 |       const response = await POST(mockRequest);
       99 |
    > 100 |       expect(response.status).toBe(401);
          |                               ^
      101 |     });
      102 |   });
      103 |

      at Object.toBe (__tests__/api/video/upscale.test.ts:100:31)

  ● POST /api/video/upscale › Rate Limiting › should return 429 when rate limit exceeded

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 400

      155 |       const response = await POST(mockRequest);
      156 |
    > 157 |       expect(response.status).toBe(429);
          |                               ^
      158 |     });
      159 |   });
      160 |

      at Object.toBe (__tests__/api/video/upscale.test.ts:157:31)

  ● POST /api/video/upscale › Success Cases › should submit upscale request successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      179 |       const response = await POST(mockRequest);
      180 |
    > 181 |       expect(response.status).toBe(200);
          |                               ^
      182 |       const data = await response.json();
      183 |       expect(data.requestId).toBe('upscale-request-123');
      184 |       expect(data.message).toContain('successfully');

      at Object.toBe (__tests__/api/video/upscale.test.ts:181:31)

  ● POST /api/video/upscale › Error Handling › should return 500 when FAL_API_KEY is not configured

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

      201 |       const response = await POST(mockRequest);
      202 |
    > 203 |       expect(response.status).toBe(500);
          |                               ^
      204 |     });
      205 |
      206 |     it('should handle FAL API errors', async () => {

      at Object.toBe (__tests__/api/video/upscale.test.ts:203:31)

  ● POST /api/video/upscale › Error Handling › should handle FAL API errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

      223 |       const response = await POST(mockRequest);
      224 |
    > 225 |       expect(response.status).toBe(500);
          |                               ^
      226 |     });
      227 |
      228 |     it('should handle timeout errors', async () => {

      at Object.toBe (__tests__/api/video/upscale.test.ts:225:31)

  ● POST /api/video/upscale › Error Handling › should handle timeout errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 504
    Received: 400

      241 |       const response = await POST(mockRequest);
      242 |
    > 243 |       expect(response.status).toBe(504);
          |                               ^
      244 |     });
      245 |   });
      246 | });

      at Object.toBe (__tests__/api/video/upscale.test.ts:243:31)

FAIL __tests__/api/projects/delete.test.ts
  ● DELETE /api/projects/[projectId] › Success Cases › should delete project successfully with valid ID

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      140 |       });
      141 |
    > 142 |       expect(response.status).toBe(200);
          |                               ^
      143 |       const data = await response.json();
      144 |       expect(data.success).toBe(true);
      145 |       expect(mockSupabase.from).toHaveBeenCalledWith('projects');

      at Object.toBe (__tests__/api/projects/delete.test.ts:142:31)

  ● DELETE /api/projects/[projectId] › Success Cases › should delete project and cascade delete related resources

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      163 |       });
      164 |
    > 165 |       expect(response.status).toBe(200);
          |                               ^
      166 |       const data = await response.json();
      167 |       expect(data.success).toBe(true);
      168 |     });

      at Object.toBe (__tests__/api/projects/delete.test.ts:165:31)

  ● DELETE /api/projects/[projectId] › Error Handling › should return 500 when database delete fails

    expect(received).toBe(expected) // Object.is equality

    Expected: "Failed to delete project"
    Received: "Internal server error"

      187 |       expect(response.status).toBe(500);
      188 |       const data = await response.json();
    > 189 |       expect(data.error).toBe('Failed to delete project');
          |                          ^
      190 |     });
      191 |
      192 |     it('should return 500 when unexpected error occurs', async () => {

      at Object.toBe (__tests__/api/projects/delete.test.ts:189:26)

  ● DELETE /api/projects/[projectId] › Authorization › should respect RLS and only delete projects owned by user

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      226 |       });
      227 |
    > 228 |       expect(response.status).toBe(200);
          |                               ^
      229 |       expect(mockSupabase.from).toHaveBeenCalledWith('projects');
      230 |     });
      231 |   });

      at Object.toBe (__tests__/api/projects/delete.test.ts:228:31)

  ● DELETE /api/projects/[projectId] › Database Interactions › should call database methods in correct order

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "id", "test-project-id"

    Number of calls: 0

      249 |       expect(mockSupabase.from).toHaveBeenCalledWith('projects');
      250 |       expect(mockSupabase.delete).toHaveBeenCalled();
    > 251 |       expect(mockSupabase.eq).toHaveBeenCalledWith('id', 'test-project-id');
          |                               ^
      252 |     });
      253 |   });
      254 |

      at Object.toHaveBeenCalledWith (__tests__/api/projects/delete.test.ts:251:31)

  ● DELETE /api/projects/[projectId] › Response Format › should return success boolean on successful deletion

    expect(received).toHaveProperty(path)

    Expected path: "success"
    Received path: []

    Received value: {"error": "Internal server error"}

      270 |       const data = await response.json();
      271 |
    > 272 |       expect(data).toHaveProperty('success');
          |                    ^
      273 |       expect(data.success).toBe(true);
      274 |     });
      275 |

      at Object.toHaveProperty (__tests__/api/projects/delete.test.ts:272:20)

FAIL __tests__/api/audio/elevenlabs/generate.test.ts
  ● POST /api/audio/elevenlabs/generate › Authentication › should return 401 when user is not authenticated

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:77:24)

  ● POST /api/audio/elevenlabs/generate › Validation › should return 400 for missing text

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:93:24)

  ● POST /api/audio/elevenlabs/generate › Validation › should return 400 for text exceeding max length

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:108:24)

  ● POST /api/audio/elevenlabs/generate › Success Cases › should generate audio successfully

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:125:24)

FAIL __tests__/api/assets/sign.test.ts
  ● GET /api/assets/sign › Input Validation › should return 400 when storageUrl is invalid

    expect(received).toBe(expected) // Object.is equality

    Expected: "Invalid storage URL"
    Received: "Invalid storage URL format. Must start with supabase://"

      84 |       expect(response.status).toBe(400);
      85 |       const data = await response.json();
    > 86 |       expect(data.error).toBe('Invalid storage URL');
         |                          ^
      87 |     });
      88 |
      89 |     it('should accept valid supabase:// storage URLs', async () => {

      at Object.toBe (__tests__/api/assets/sign.test.ts:86:26)

  ● GET /api/assets/sign › Asset Lookup by assetId › should fetch storageUrl from database when assetId provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      117 |       const response = await GET(mockRequest);
      118 |
    > 119 |       expect(response.status).toBe(200);
          |                               ^
      120 |       expect(mockSupabase.select).toHaveBeenCalledWith('storage_url, user_id');
      121 |       expect(mockSupabase.eq).toHaveBeenCalledWith('id', 'asset-123');
      122 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:119:31)

  ● GET /api/assets/sign › Asset Lookup by assetId › should return 404 when asset not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      133 |       const response = await GET(mockRequest);
      134 |
    > 135 |       expect(response.status).toBe(404);
          |                               ^
      136 |       const data = await response.json();
      137 |       expect(data.error).toBe('Asset not found');
      138 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:135:31)

  ● GET /api/assets/sign › Asset Lookup by assetId › should return 403 when asset belongs to different user

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

      154 |       const response = await GET(mockRequest);
      155 |
    > 156 |       expect(response.status).toBe(403);
          |                               ^
      157 |       const data = await response.json();
      158 |       expect(data.error).toContain('asset does not belong to user');
      159 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:156:31)

  ● GET /api/assets/sign › Asset Authorization by storageUrl › should skip folder check when assetId was used for lookup

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      202 |       const response = await GET(mockRequest);
      203 |
    > 204 |       expect(response.status).toBe(200);
          |                               ^
      205 |     });
      206 |   });
      207 |

      at Object.toBe (__tests__/api/assets/sign.test.ts:204:31)

  ● GET /api/assets/sign › Storage Bucket Handling › should handle different storage buckets

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "custom-bucket"

    Number of calls: 0

      285 |       await GET(mockRequest);
      286 |
    > 287 |       expect(mockSupabase.storage.from).toHaveBeenCalledWith('custom-bucket');
          |                                         ^
      288 |     });
      289 |
      290 |     it('should handle paths with multiple slashes', async () => {

      at Object.toHaveBeenCalledWith (__tests__/api/assets/sign.test.ts:287:41)

  ● GET /api/assets/sign › Error Handling › should return 500 when database query fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      333 |       const response = await GET(mockRequest);
      334 |
    > 335 |       expect(response.status).toBe(404);
          |                               ^
      336 |     });
      337 |
      338 |     it('should handle unexpected errors gracefully', async () => {

      at Object.toBe (__tests__/api/assets/sign.test.ts:335:31)

  ● GET /api/assets/sign › Error Handling › should handle unexpected errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

      348 |       const response = await GET(mockRequest);
      349 |
    > 350 |       expect(response.status).toBe(500);
          |                               ^
      351 |       const data = await response.json();
      352 |       expect(data.error).toBe('Internal server error');
      353 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:350:31)

FAIL __tests__/api/assets/get.test.ts
  ● GET /api/assets › Success Cases › should return all assets for authenticated user

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      78 |         count: mockAssets.length,
      79 |       });
    > 80 |       mockSupabase.range.mockResolvedValue({
         |                          ^
      81 |         data: mockAssets,
      82 |         error: null,
      83 |         count: mockAssets.length,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:80:26)

  ● GET /api/assets › Success Cases › should filter assets by projectId

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

       98 |       const mockAssets = [createMockAsset({ project_id: 'project-1' })];
       99 |
    > 100 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      101 |         data: mockAssets,
      102 |         error: null,
      103 |         count: 1,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:100:26)

  ● GET /api/assets › Success Cases › should filter assets by type

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      116 |       const mockAssets = [createMockAsset({ type: 'video' })];
      117 |
    > 118 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      119 |         data: mockAssets,
      120 |         error: null,
      121 |         count: 1,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:118:26)

  ● GET /api/assets › Success Cases › should support pagination

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      132 |     it('should support pagination', async () => {
      133 |       mockAuthenticatedUser(mockSupabase);
    > 134 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      135 |         data: [],
      136 |         error: null,
      137 |         count: 100,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:134:26)

  ● GET /api/assets › Error Handling › should return 500 on database error

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      188 |     it('should return 500 on database error', async () => {
      189 |       mockAuthenticatedUser(mockSupabase);
    > 190 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      191 |         data: null,
      192 |         error: { message: 'Database error', code: 'DB_ERROR' },
      193 |         count: null,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:190:26)

FAIL __tests__/api/export/export.test.ts
  ● POST /api/export › Success Cases › should create export job successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 202
    Received: 400

      123 |
      124 |       const response = await POST(mockRequest);
    > 125 |       expect(response.status).toBe(202);
          |                               ^
      126 |       const data = await response.json();
      127 |       expect(data.jobId).toBe('job-123');
      128 |       expect(data.status).toBe('queued');

      at Object.toBe (__tests__/api/export/export.test.ts:125:31)

  ● GET /api/export › Success Cases › should get export job status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      160 |       const response = await GET(mockRequest);
      161 |
    > 162 |       expect(response.status).toBe(200);
          |                               ^
      163 |     });
      164 |   });
      165 | });

      at Object.toBe (__tests__/api/export/export.test.ts:162:31)

FAIL __tests__/api/payments/checkout.test.ts
  ● POST /api/stripe/checkout › Stripe Customer Creation › should create new Stripe customer when not exists

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"email": "test@example.com", "stripeCustomerId": null, "userId": "test-user-id"}

    Number of calls: 0

      201 |       await POST(mockRequest);
      202 |
    > 203 |       expect(getOrCreateStripeCustomer).toHaveBeenCalledWith({
          |                                         ^
      204 |         userId: mockUser.id,
      205 |         email: mockUser.email,
      206 |         stripeCustomerId: null,

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:203:41)

  ● POST /api/stripe/checkout › Stripe Customer Creation › should use existing Stripe customer when available

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"email": "test@example.com", "stripeCustomerId": "cus_existing_123", "userId": "test-user-id"}

    Number of calls: 0

      232 |       await POST(mockRequest);
      233 |
    > 234 |       expect(getOrCreateStripeCustomer).toHaveBeenCalledWith({
          |                                         ^
      235 |         userId: mockUser.id,
      236 |         email: mockUser.email,
      237 |         stripeCustomerId: 'cus_existing_123',

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:234:41)

  ● POST /api/stripe/checkout › Checkout Session Creation › should create checkout session with default price

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"cancelUrl": StringContaining "/settings", "customerId": "cus_test_123", "priceId": "price_test_premium", "successUrl": StringContaining "/settings?session_id=", "userId": "test-user-id"}

    Number of calls: 0

      262 |       const response = await POST(mockRequest);
      263 |
    > 264 |       expect(createCheckoutSession).toHaveBeenCalledWith({
          |                                     ^
      265 |         customerId: 'cus_test_123',
      266 |         priceId: 'price_test_premium',
      267 |         userId: mockUser.id,

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:264:37)

  ● POST /api/stripe/checkout › Checkout Session Creation › should create checkout session with custom price

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"priceId": "price_custom_123"}

    Number of calls: 0

      295 |       await POST(mockRequest);
      296 |
    > 297 |       expect(createCheckoutSession).toHaveBeenCalledWith(
          |                                     ^
      298 |         expect.objectContaining({
      299 |           priceId: 'price_custom_123',
      300 |         })

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:297:37)

  ● POST /api/stripe/checkout › Checkout Session Creation › should return 500 when price ID not configured

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 429

      322 |       const response = await POST(mockRequest);
      323 |
    > 324 |       expect(response.status).toBe(500);
          |                               ^
      325 |       const data = await response.json();
      326 |       expect(data.error).toBe('Price ID not configured');
      327 |     });

      at Object.toBe (__tests__/api/payments/checkout.test.ts:324:31)

  ● POST /api/stripe/checkout › Error Handling › should return 500 when Stripe API fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 429

      348 |       const response = await POST(mockRequest);
      349 |
    > 350 |       expect(response.status).toBe(500);
          |                               ^
      351 |       const data = await response.json();
      352 |       expect(data.error).toBe('Failed to create checkout session');
      353 |     });

      at Object.toBe (__tests__/api/payments/checkout.test.ts:350:31)

  ● POST /api/stripe/checkout › Error Handling › should handle malformed JSON body

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 429

      365 |       const response = await POST(mockRequest);
      366 |
    > 367 |       expect(response.status).toBe(500);
          |                               ^
      368 |     });
      369 |   });
      370 |

      at Object.toBe (__tests__/api/payments/checkout.test.ts:367:31)

  ● POST /api/stripe/checkout › Response Format › should return sessionId and url

    expect(received).toHaveProperty(path, value)

    Expected path: "sessionId"
    Received path: []

    Expected value: "cs_test_456"
    Received value: {"error": "Rate limit exceeded", "limit": 5, "remaining": 0, "resetAt": 1761275604353, "retryAfter": 60}

      394 |       const data = await response.json();
      395 |
    > 396 |       expect(data).toHaveProperty('sessionId', 'cs_test_456');
          |                    ^
      397 |       expect(data).toHaveProperty('url', 'https://checkout.stripe.com/test456');
      398 |     });
      399 |   });

      at Object.toHaveProperty (__tests__/api/payments/checkout.test.ts:396:20)

  ● POST /api/stripe/checkout › URL Configuration › should use NEXT_PUBLIC_BASE_URL when available

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"cancelUrl": "https://example.com/settings", "successUrl": "https://example.com/settings?session_id={CHECKOUT_SESSION_ID}"}

    Number of calls: 0

      421 |       await POST(mockRequest);
      422 |
    > 423 |       expect(createCheckoutSession).toHaveBeenCalledWith(
          |                                     ^
      424 |         expect.objectContaining({
      425 |           successUrl: 'https://example.com/settings?session_id={CHECKOUT_SESSION_ID}',
      426 |           cancelUrl: 'https://example.com/settings',

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:423:37)

  ● POST /api/stripe/checkout › URL Configuration › should fallback to request origin when BASE_URL not set

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"cancelUrl": StringContaining "http://localhost:3000/settings", "successUrl": StringContaining "http://localhost:3000/settings"}

    Number of calls: 0

      450 |       await POST(mockRequest);
      451 |
    > 452 |       expect(createCheckoutSession).toHaveBeenCalledWith(
          |                                     ^
      453 |         expect.objectContaining({
      454 |           successUrl: expect.stringContaining('http://localhost:3000/settings'),
      455 |           cancelUrl: expect.stringContaining('http://localhost:3000/settings'),

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:452:37)

FAIL __tests__/api/payments/webhook.test.ts
  ● POST /api/stripe/webhook › Webhook Verification › should verify webhook signature correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      178 |
      179 |       expect(mockConstructEvent).toHaveBeenCalledWith(body, 'valid-signature', 'whsec_test_secret');
    > 180 |       expect(response.status).toBe(200);
          |                               ^
      181 |     });
      182 |   });
      183 |

      at Object.toBe (__tests__/api/payments/webhook.test.ts:180:31)

  ● POST /api/stripe/webhook › checkout.session.completed Event › should upgrade user to premium on successful checkout

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      222 |       const response = await POST(mockRequest);
      223 |
    > 224 |       expect(response.status).toBe(200);
          |                               ^
      225 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      226 |         expect.objectContaining({
      227 |           tier: 'premium',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:224:31)

  ● POST /api/stripe/webhook › checkout.session.completed Event › should preserve admin tier on checkout

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      268 |       const response = await POST(mockRequest);
      269 |
    > 270 |       expect(response.status).toBe(200);
          |                               ^
      271 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      272 |         expect.objectContaining({
      273 |           tier: 'admin', // Should remain admin

      at Object.toBe (__tests__/api/payments/webhook.test.ts:270:31)

  ● POST /api/stripe/webhook › customer.subscription.updated Event › should update subscription status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      393 |       const response = await POST(mockRequest);
      394 |
    > 395 |       expect(response.status).toBe(200);
          |                               ^
      396 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      397 |         expect.objectContaining({
      398 |           subscription_status: 'active',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:395:31)

  ● POST /api/stripe/webhook › customer.subscription.updated Event › should downgrade to free when subscription becomes inactive

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      436 |       const response = await POST(mockRequest);
      437 |
    > 438 |       expect(response.status).toBe(200);
          |                               ^
      439 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      440 |         expect.objectContaining({
      441 |           tier: 'free',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:438:31)

  ● POST /api/stripe/webhook › customer.subscription.updated Event › should preserve admin tier on subscription update

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tier": "admin"}

    Number of calls: 0

      478 |       const response = await POST(mockRequest);
      479 |
    > 480 |       expect(mockSupabase.update).toHaveBeenCalledWith(
          |                                   ^
      481 |         expect.objectContaining({
      482 |           tier: 'admin',
      483 |         })

      at Object.toHaveBeenCalledWith (__tests__/api/payments/webhook.test.ts:480:35)

  ● POST /api/stripe/webhook › customer.subscription.deleted Event › should downgrade user to free tier

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      520 |       const response = await POST(mockRequest);
      521 |
    > 522 |       expect(response.status).toBe(200);
          |                               ^
      523 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      524 |         expect.objectContaining({
      525 |           tier: 'free',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:522:31)

  ● POST /api/stripe/webhook › customer.subscription.deleted Event › should preserve admin tier on subscription deletion

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tier": "admin"}

    Number of calls: 0

      564 |       const response = await POST(mockRequest);
      565 |
    > 566 |       expect(mockSupabase.update).toHaveBeenCalledWith(
          |                                   ^
      567 |         expect.objectContaining({
      568 |           tier: 'admin',
      569 |         })

      at Object.toHaveBeenCalledWith (__tests__/api/payments/webhook.test.ts:566:35)

FAIL __tests__/api/video/status.test.ts
  ● GET /api/video/status › Authentication › should return 401 when user is not authenticated

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 500

       95 |       const response = await GET(mockRequest);
       96 |
    >  97 |       expect(response.status).toBe(401);
          |                               ^
       98 |     });
       99 |
      100 |     it('should return 429 when rate limit exceeded', async () => {

      at Object.toBe (__tests__/api/video/status.test.ts:97:31)

  ● GET /api/video/status › Authentication › should return 429 when rate limit exceeded

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 500

      113 |       const response = await GET(mockRequest);
      114 |
    > 115 |       expect(response.status).toBe(429);
          |                               ^
      116 |       const body = await response.json();
      117 |       expect(body.error).toBe('Rate limit exceeded');
      118 |     });

      at Object.toBe (__tests__/api/video/status.test.ts:115:31)

  ● GET /api/video/status › FAL Video Status › should check FAL operation status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      158 |       const response = await GET(mockRequest);
      159 |
    > 160 |       expect(response.status).toBe(200);
          |                               ^
      161 |       expect(checkFalVideoStatus).toHaveBeenCalledWith('request-123', 'seedance-1.0-pro');
      162 |       const data = await response.json();
      163 |       expect(data.done).toBe(false);

      at Object.toBe (__tests__/api/video/status.test.ts:160:31)

  ● GET /api/video/status › Veo Video Status › should check Veo operation status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      258 |       const response = await GET(mockRequest);
      259 |
    > 260 |       expect(response.status).toBe(200);
          |                               ^
      261 |       expect(checkOperationStatus).toHaveBeenCalledWith('operations/veo-123');
      262 |       const data = await response.json();
      263 |       expect(data.done).toBe(false);

      at Object.toBe (__tests__/api/video/status.test.ts:260:31)

  ● GET /api/video/status › Veo Video Status › should download Veo video from GCS URI

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      355 |       const response = await GET(mockRequest);
      356 |
    > 357 |       expect(response.status).toBe(200);
          |                               ^
      358 |       const data = await response.json();
      359 |       expect(data.done).toBe(true);
      360 |

      at Object.toBe (__tests__/api/video/status.test.ts:357:31)

PASS __tests__/services/projectService.test.ts
PASS __tests__/state/useEditorStore.test.ts
PASS __tests__/components/LoadingSpinner.test.tsx
{"level":30,"time":1761275544571,"env":"test","service":"genai-video-production","event":"cache.initialized","type":"lru","maxSize":1000,"msg":"Cache initialized with LRU strategy (max 1000 entries)"}
{"level":30,"time":1761275544577,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544578,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544585,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544589,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544590,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":1,"msg":"Cache cleared: 1 entries removed"}
{"level":30,"time":1761275544590,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":1,"msg":"Cache cleared: 1 entries removed"}
{"level":30,"time":1761275544590,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544591,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":1,"msg":"Cache cleared: 1 entries removed"}
{"level":30,"time":1761275544591,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544601,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544602,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544602,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544602,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544603,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544603,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544604,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
{"level":30,"time":1761275544604,"env":"test","service":"genai-video-production","event":"cache.cleared","entriesCleared":0,"msg":"Cache cleared: 0 entries removed"}
PASS __tests__/lib/hooks/usePolling.test.ts
PASS __tests__/services/assetService.test.ts
PASS __tests__/components/ErrorBoundary.test.tsx
PASS __tests__/components/editor/AssetPanel.test.tsx
PASS __tests__/components/generation/VideoQueueItem.test.tsx
PASS __tests__/lib/hooks/useDebounce.test.ts
PASS __tests__/services/userService.test.ts
PASS __tests__/components/EditorHeader.test.tsx
  ● Console

    console.error
      An update to EditorHeader inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setProjects (components/EditorHeader.tsx:41:9)

    console.error
      An update to EditorHeader inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setCurrentProject (components/EditorHeader.tsx:43:9)

    console.error
      An update to EditorHeader inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setProjects (components/EditorHeader.tsx:41:9)

    console.error
      An update to EditorHeader inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setCurrentProject (components/EditorHeader.tsx:43:9)

    console.error
      [ERROR] Failed to rename project {
        error: {
          name: 'Error',
          message: 'Update failed',
          stack: 'Error: Update failed\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/EditorHeader.test.tsx:277:48)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        projectId: 'project-1'
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/EditorHeader.tsx:89:21)

PASS __tests__/lib/rateLimit.test.ts
PASS __tests__/services/audioService.test.ts
PASS __tests__/services/videoService.test.ts
PASS __tests__/lib/fetchWithTimeout.test.ts
PASS __tests__/lib/api/response.test.ts
PASS __tests__/lib/password-validation.test.ts
PASS __tests__/lib/errorTracking.test.ts
PASS __tests__/lib/validation.test.ts
FAIL __tests__/api/image/generate.test.ts
  ● Test suite failed to run

    Jest encountered an unexpected token

    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.

    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.

    By default "node_modules" folder is ignored by transformers.

    Here's what you can do:
     • If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.
     • If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript
     • To have some of your "node_modules" files transformed, you can specify a custom "transformIgnorePatterns" in your config.
     • If you need a custom transformation, specify a "transform" option in your config.
     • If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the "moduleNameMapper" config option.

    You'll find more details and examples of these config options in the docs:
    https://jestjs.io/docs/configuration
    For information about custom transformations, see:
    https://jestjs.io/docs/code-transformation

    Details:

    /Users/davidchen/Projects/non-linear-editor/node_modules/uuid/dist-node/index.js:1
    export { default as MAX } from './max.js';
    ^^^^^^

    SyntaxError: Unexpected token 'export'

      14 |   validatePersonGeneration,
      15 |   validateAll,
    > 16 | } from '@/lib/api/validation';
         |               ^
      17 | import {
      18 |   unauthorizedResponse,
      19 |   rateLimitResponse,

      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)
      at Object.<anonymous> (app/api/image/generate/route.ts:16:15)
      at Object.<anonymous> (__tests__/api/image/generate.test.ts:71:16)

PASS __tests__/api/admin/change-tier.test.ts
PASS __tests__/lib/utils/arrayUtils.test.ts
PASS __tests__/lib/api/validation.test.ts
FAIL __tests__/helpers/supabase.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/helpers/mocks.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/helpers/api.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

PASS __tests__/components/UserMenu.test.tsx
  ● Console

    console.error
      Error: Not implemented: navigation (except hash changes)
          at ignore-listed frames {
        type: 'not implemented'
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at VirtualConsole.<anonymous> (node_modules/@jest/environment-jsdom-abstract/build/index.js:87:23)
      at module.exports (node_modules/jsdom/lib/jsdom/browser/not-implemented.js:12:26)
      at navigateFetch (node_modules/jsdom/lib/jsdom/living/window/navigation.js:77:3)
      at exports.navigate (node_modules/jsdom/lib/jsdom/living/window/navigation.js:55:3)
      at Timeout._onTimeout (node_modules/jsdom/lib/jsdom/living/nodes/HTMLHyperlinkElementUtils-impl.js:80:7)

    console.error
      An update to UserMenu inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setUserEmail (components/UserMenu.tsx:35:9)

{"level":50,"time":1761275544842,"env":"test","service":"genai-video-production","error":{"type":"Error","message":"Test error","stack":"Error: Test error\n    at handler (/Users/davidchen/Projects/non-linear-editor/__tests__/lib/api/response.test.ts:334:15)\n    at handler (/Users/davidchen/Projects/non-linear-editor/lib/api/response.ts:289:20)\n    at Object.wrappedHandler (/Users/davidchen/Projects/non-linear-editor/__tests__/lib/api/response.test.ts:338:30)\n    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n    at new Promise (<anonymous>)\n    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)"},"msg":"Handler error"}
{"level":50,"time":1761275544849,"env":"test","service":"genai-video-production","error":"String error","msg":"Handler error"}
PASS __tests__/components/SubscriptionManager.test.tsx
  ● Console

    console.error
      An update to SubscriptionManager inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setProfile (components/SubscriptionManager.tsx:42:9)

    console.error
      An update to SubscriptionManager inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setLoading (components/SubscriptionManager.tsx:45:7)

    console.error
      [ERROR] Error upgrading subscription {
        error: {
          name: 'Error',
          message: 'Payment failed',
          stack: 'Error: Payment failed\n' +
            '    at handleUpgrade (/Users/davidchen/Projects/non-linear-editor/components/SubscriptionManager.tsx:64:15)'
        }
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/SubscriptionManager.tsx:72:21)

FAIL __tests__/helpers/index.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/components/CreateProjectButton.test.tsx
  ● Test suite failed to run

    Cannot find module 'tailwind-merge' from 'lib/utils.ts'

    Require stack:
      lib/utils.ts
      components/ui/Button.tsx
      components/CreateProjectButton.tsx
      __tests__/components/CreateProjectButton.test.tsx



      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/index.js:863:11)
      at Object.<anonymous> (lib/utils.ts:12:24)
      at Object.<anonymous> (components/ui/Button.tsx:13:16)
      at Object.<anonymous> (components/CreateProjectButton.tsx:24:17)
      at Object.<anonymous> (__tests__/components/CreateProjectButton.test.tsx:28:30)

FAIL __tests__/components/HorizontalTimeline.test.tsx
  ● Test suite failed to run

    Cannot find module 'tailwind-merge' from 'lib/utils.ts'

    Require stack:
      lib/utils.ts
      components/ui/Button.tsx
      components/timeline/TimelineControls.tsx
      components/HorizontalTimeline.tsx
      __tests__/components/HorizontalTimeline.test.tsx



      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/index.js:863:11)
      at Object.<anonymous> (lib/utils.ts:12:24)
      at Object.<anonymous> (components/ui/Button.tsx:13:16)
      at Object.<anonymous> (components/timeline/TimelineControls.tsx:16:17)
      at Object.<anonymous> (components/HorizontalTimeline.tsx:28:27)
      at Object.<anonymous> (__tests__/components/HorizontalTimeline.test.tsx:11:68)

FAIL __tests__/helpers/components.tsx
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/components/PreviewPlayer.test.tsx
  ● Console

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:209:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:209:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:245:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 5.5
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:245:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:252:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at processTicksAndRejections (node:internal/process/task_queues:105:5)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:252:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:264:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:264:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:276:33)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:276:33)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:296:33)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 5
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:296:33)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:327:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:327:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:335:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:335:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:341:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:341:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:353:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:353:11)

    console.error
      Failed to send logs to server: ReferenceError: fetch is not defined
          at sendLogs (/Users/davidchen/Projects/non-linear-editor/lib/browserLogger.ts:182:26)
          at BrowserLogger.sendLogs [as flush] (/Users/davidchen/Projects/non-linear-editor/lib/browserLogger.ts:219:7)
          at BrowserLogger.flush [as log] (/Users/davidchen/Projects/non-linear-editor/lib/browserLogger.ts:153:12)
          at BrowserLogger.log [as error] (/Users/davidchen/Projects/non-linear-editor/lib/browserLogger.ts:243:10)
          at error (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:165:25)
          at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5
          at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
          at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
          at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
          at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
          at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
          at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
          at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
          at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
          at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
          at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)
          at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)
          at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25
          at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)
          at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)
          at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:353:11)
          at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)
          at new Promise (<anonymous>)
          at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)
          at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)
          at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)
          at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7
          at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)
          at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)
          at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)
          at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)
          at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)
          at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)
          at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)
          at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at error (lib/browserLogger.ts:201:19)
      at BrowserLogger.sendLogs [as flush] (lib/browserLogger.ts:219:7)
      at BrowserLogger.flush [as log] (lib/browserLogger.ts:153:12)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:353:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:364:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:364:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:372:33)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:372:33)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:384:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:384:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:395:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:395:11)

    console.error
      [ERROR] Failed to warm clips at current time {
        error: {
          name: 'TypeError',
          message: "Cannot read properties of undefined (reading 'catch')",
          stack: "TypeError: Cannot read properties of undefined (reading 'catch')\n" +
            '    at clip (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:152:31)\n' +
            '    at Array.map (<anonymous>)\n' +
            '    at map (/Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:151:19)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/PreviewPlayer.tsx:168:5\n' +
            '    at Object.react_stack_bottom_frame (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)\n' +
            '    at runWithFiberInDEV (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:874:13)\n' +
            '    at commitHookEffectListMount (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)\n' +
            '    at commitHookPassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)\n' +
            '    at recursivelyTraversePassiveMountEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)\n' +
            '    at commitPassiveMountOnFiber (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)\n' +
            '    at flushPassiveEffects (/Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/react-dom/cjs/react-dom-client.development.js:17923:15\n' +
            '    at flushActQueue (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:590:34)\n' +
            '    at process.env.NODE_ENV.exports.act (/Users/davidchen/Projects/non-linear-editor/node_modules/react/cjs/react.development.js:884:10)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/act-compat.js:47:25\n' +
            '    at renderRoot (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:190:26)\n' +
            '    at render (/Users/davidchen/Projects/non-linear-editor/node_modules/@testing-library/react/dist/pure.js:292:10)\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/PreviewPlayer.test.tsx:466:11)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        },
        currentTime: 0
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/PreviewPlayer.tsx:165:25)
      at components/PreviewPlayer.tsx:168:5
      at Object.react_stack_bottom_frame (node_modules/react-dom/cjs/react-dom-client.development.js:25989:20)
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at commitHookEffectListMount (node_modules/react-dom/cjs/react-dom-client.development.js:13249:29)
      at commitHookPassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:13336:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15484:13)
      at recursivelyTraversePassiveMountEffects (node_modules/react-dom/cjs/react-dom-client.development.js:15439:11)
      at commitPassiveMountOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:15519:11)
      at flushPassiveEffects (node_modules/react-dom/cjs/react-dom-client.development.js:18432:9)
      at node_modules/react-dom/cjs/react-dom-client.development.js:17923:15
      at flushActQueue (node_modules/react/cjs/react.development.js:590:34)
      at process.env.NODE_ENV.exports.act (node_modules/react/cjs/react.development.js:884:10)
      at node_modules/@testing-library/react/dist/act-compat.js:47:25
      at renderRoot (node_modules/@testing-library/react/dist/pure.js:190:26)
      at render (node_modules/@testing-library/react/dist/pure.js:292:10)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:466:11)

  ● PreviewPlayer › should display current time and total duration

    TestingLibraryElementError: Unable to find an element with the text: /00:05:15/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"relative flex h-full flex-col"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"absolute inset-0"[39m
            [36m/>[39m
            [36m<div[39m
              [33mdata-testid[39m=[32m"playback-controls"[39m
            [36m>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Play (Space)"[39m
              [36m>[39m
                [0mPlay[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Enter fullscreen"[39m
              [36m>[39m
                [0mFullscreen[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Hide controls"[39m
              [36m>[39m
                [0mHide[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      246 |
      247 |     // Should show timecode (MM:SS:FF format)
    > 248 |     expect(screen.getByText(/00:05:15/)).toBeInTheDocument(); // 5.5 seconds
          |                   ^
      249 |   });
      250 |
      251 |   it('should toggle play/pause when clicking play button', async () => {

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (__tests__/components/PreviewPlayer.test.tsx:248:19)

  ● PreviewPlayer › should display progress bar

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

      278 |     // Find progress bar
      279 |     const progressBar = container.querySelector('.bg-white.transition-all');
    > 280 |     expect(progressBar).toBeInTheDocument();
          |                         ^
      281 |   });
      282 |
      283 |   it('should calculate progress correctly', () => {

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:2240:22)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:2241:6)
      at Object.toBeInTheDocument (__tests__/components/PreviewPlayer.test.tsx:280:25)

  ● PreviewPlayer › should calculate progress correctly

    expect(received).toHaveStyle()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

      297 |
      298 |     const progressBar = container.querySelector('.bg-white.transition-all') as HTMLElement;
    > 299 |     expect(progressBar).toHaveStyle({ width: '50%' });
          |                         ^
      300 |   });
      301 |
      302 |   it('should render text overlay editor when present and not playing', () => {

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:2240:22)
      at Object.throwingMatcher [as toHaveStyle] (node_modules/expect/build/index.js:2241:6)
      at Object.toHaveStyle (__tests__/components/PreviewPlayer.test.tsx:299:25)

  ● PreviewPlayer › should toggle fullscreen on button click

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex h-full flex-col"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"absolute inset-0"[39m
              [36m/>[39m
              [36m<div[39m
                [33mdata-testid[39m=[32m"playback-controls"[39m
              [36m>[39m
                [36m<button[39m
                  [33mtitle[39m=[32m"Play (Space)"[39m
                [36m>[39m
                  [0mPlay[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mtitle[39m=[32m"Enter fullscreen"[39m
                [36m>[39m
                  [0mFullscreen[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mtitle[39m=[32m"Hide controls"[39m
                [36m>[39m
                  [0mHide[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      357 |
      358 |     await waitFor(() => {
    > 359 |       expect(mockRequestFullscreen).toHaveBeenCalled();
          |                                     ^
      360 |     });
      361 |   });
      362 |

      at toHaveBeenCalled (__tests__/components/PreviewPlayer.test.tsx:359:37)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● PreviewPlayer › should handle keyboard spacebar to toggle play/pause

    Unable to find an element with the title: Pause (Space).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"relative flex h-full flex-col"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"absolute inset-0"[39m
            [36m/>[39m
            [36m<div[39m
              [33mdata-testid[39m=[32m"playback-controls"[39m
            [36m>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Play (Space)"[39m
              [36m>[39m
                [0mPlay[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Enter fullscreen"[39m
              [36m>[39m
                [0mFullscreen[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Hide controls"[39m
              [36m>[39m
                [0mHide[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      397 |     fireEvent.keyDown(window, { code: 'Space', target: document.body });
      398 |
    > 399 |     await waitFor(() => {
          |                  ^
      400 |       expect(screen.getByTitle('Pause (Space)')).toBeInTheDocument();
      401 |     });
      402 |   });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:399:18)

  ● PreviewPlayer › should show timecode in MM:SS:FF format

    TestingLibraryElementError: Unable to find an element with the text: /02:05:15/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"relative flex h-full flex-col"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"absolute inset-0"[39m
            [36m/>[39m
            [36m<div[39m
              [33mdata-testid[39m=[32m"playback-controls"[39m
            [36m>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Play (Space)"[39m
              [36m>[39m
                [0mPlay[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Enter fullscreen"[39m
              [36m>[39m
                [0mFullscreen[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Hide controls"[39m
              [36m>[39m
                [0mHide[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      437 |
      438 |     // 125.5 seconds = 02:05:15 (2 minutes, 5 seconds, 15 frames)
    > 439 |     expect(screen.getByText(/02:05:15/)).toBeInTheDocument();
          |                   ^
      440 |   });
      441 |
      442 |   it('should handle clips with transitions', () => {

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (__tests__/components/PreviewPlayer.test.tsx:439:19)

FAIL __tests__/components/ActivityHistory.test.tsx
  ● Console

    console.error
      [ERROR] Error clearing activity history {
        error: {
          name: 'Error',
          message: 'Failed to clear history',
          stack: 'Error: Failed to clear history\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/components/ActivityHistory.tsx:162:15'
        }
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/ActivityHistory.tsx:168:21)

    console.error
      [ERROR] Error loading activity history { status: 500, statusText: 'Internal Server Error' }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/ActivityHistory.tsx:127:23)

    console.error
      [ERROR] Error loading activity history {
        error: {
          name: 'Error',
          message: 'Network error',
          stack: 'Error: Network error\n' +
            '    at Object.<anonymous> (/Users/davidchen/Projects/non-linear-editor/__tests__/components/ActivityHistory.test.tsx:437:57)\n' +
            '    at Promise.finally.completed (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1557:28)\n' +
            '    at new Promise (<anonymous>)\n' +
            '    at callAsyncCircusFn (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1497:10)\n' +
            '    at _callCircusTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1007:40)\n' +
            '    at _runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:947:3)\n' +
            '    at /Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:849:7\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:862:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at _runTestsForDescribeBlock (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:857:11)\n' +
            '    at run (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:761:3)\n' +
            '    at runAndTransformResultsToJestFormat (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/jestAdapterInit.js:1918:21)\n' +
            '    at jestAdapter (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-circus/build/runner.js:101:19)\n' +
            '    at runTestInternal (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:275:16)\n' +
            '    at runTest (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:343:7)\n' +
            '    at Object.worker (/Users/davidchen/Projects/non-linear-editor/node_modules/jest-runner/build/testWorker.js:497:12)'
        }
      }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/ActivityHistory.tsx:139:21)

    console.error
      [ERROR] Error loading activity history { status: 500, statusText: undefined }

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at BrowserLogger.log (lib/browserLogger.ts:145:29)
      at BrowserLogger.log [as error] (lib/browserLogger.ts:243:10)
      at error (components/ActivityHistory.tsx:127:23)

  ● ActivityHistory › Relative Time Display › should display formatted date for old activities

    Found multiple elements with the text: (content, element)=>{
                        return element?.className.includes('whitespace-nowrap') && content.length > 0;
                    }

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
    [36m>[39m
      [0m1 hour ago[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
    [36m>[39m
      [0m1 day ago[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
    [36m>[39m
      [0mOct 16[0m
    [36m</span>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-xl border border-neutral-200 bg-white p-6 shadow-sm"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-4 flex items-center justify-between"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-xl font-semibold text-neutral-900"[39m
            [36m>[39m
              [0mActivity History[0m
            [36m</h2>[39m
            [36m<button[39m
              [33mclass[39m=[32m"rounded-lg bg-neutral-100 px-3 py-1.5 text-xs font-medium text-neutral-700 hover:bg-neutral-200 disabled:cursor-not-allowed disabled:opacity-50"[39m
            [36m>[39m
              [0mClear History[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-h-96 overflow-y-auto"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m🎬[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mEpic Sci-Fi Scene[0m
                      [36m</h3>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-600 line-clamp-2"[39m
                      [36m>[39m
                        [0mA futuristic cityscape with flying cars[0m
                      [36m</p>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-500"[39m
                      [36m>[39m
                        [0mModel: [0m
                        [0mveo-2.0[0m
                      [36m</p>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m8[0m
                          [0ms[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m1080p[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m16:9[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0m1 hour ago[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m🎵[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mBackground Music[0m
                      [36m</h3>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-600 line-clamp-2"[39m
                      [36m>[39m
                        [0mAmbient electronic track[0m
                      [36m</p>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-500"[39m
                      [36m>[39m
                        [0mModel: [0m
                        [0melevenlabs-music[0m
                      [36m</p>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m30[0m
                          [0ms[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0m1 day ago[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m📹[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mVideo Uploaded[0m
                      [36m</h3>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m50.0[0m
                          [0m MB[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0mOct 16[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"pt-2 text-center text-xs text-neutral-500"[39m
            [36m>[39m
              [0mShowing [0m
              [0m3[0m
              [0m [0m
              [0mentries[0m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      255 |     it('should display formatted date for old activities', async () => {
      256 |       render(<ActivityHistory />);
    > 257 |       await waitFor(() => {
          |                    ^
      258 |         const timeText = screen.getByText((content, element) => {
      259 |           return element?.className.includes('whitespace-nowrap') && content.length > 0;
      260 |         });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/ActivityHistory.test.tsx:257:20)

  ● ActivityHistory › Activity Types › should handle unknown activity type

    Unable to find an element with the text: Activity. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-xl border border-neutral-200 bg-white p-6 shadow-sm"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-4 flex items-center justify-between"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-xl font-semibold text-neutral-900"[39m
            [36m>[39m
              [0mActivity History[0m
            [36m</h2>[39m
            [36m<button[39m
              [33mclass[39m=[32m"rounded-lg bg-neutral-100 px-3 py-1.5 text-xs font-medium text-neutral-700 hover:bg-neutral-200 disabled:cursor-not-allowed disabled:opacity-50"[39m
            [36m>[39m
              [0mClear History[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-h-96 overflow-y-auto"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m📄[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mEpic Sci-Fi Scene[0m
                      [36m</h3>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-600 line-clamp-2"[39m
                      [36m>[39m
                        [0mA futuristic cityscape with flying cars[0m
                      [36m</p>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-500"[39m
                      [36m>[39m
                        [0mModel: [0m
                        [0mveo-2.0[0m
                      [36m</p>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m8[0m
                          [0ms[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m1080p[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m16:9[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0m1 hour ago[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"pt-2 text-center text-xs text-neutral-500"[39m
            [36m>[39m
              [0mShowing [0m
              [0m1[0m
              [0m [0m
              [0mentry[0m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      500 |       render(<ActivityHistory />);
      501 |
    > 502 |       await waitFor(() => {
          |                    ^
      503 |         expect(screen.getByText('📄')).toBeInTheDocument();
      504 |         expect(screen.getByText('Activity')).toBeInTheDocument();
      505 |       });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/ActivityHistory.test.tsx:502:20)

FAIL __tests__/components/editor/ChatBox.test.tsx (8.291 s)
  ● Console

    console.error
      An update to ChatBox inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setLoadingMessages (components/editor/ChatBox.tsx:72:7)

    console.error
      An update to ChatBox inside a test was not wrapped in act(...).
      
      When testing, code that causes React state updates should be wrapped into act(...):
      
      act(() => {
        /* fire events that update state */
      });
      /* assert on the output */
      
      This ensures that you're testing the behavior the user would see in the browser. Learn more at https://react.dev/link/wrap-tests-with-act

      32 |       return;
      33 |     }
    > 34 |     originalError.call(console, ...args);
         |                   ^
      35 |   };
      36 | });
      37 |

      at console.call [as error] (jest.setup-after-env.js:34:19)
      at node_modules/react-dom/cjs/react-dom-client.development.js:18758:19
      at runWithFiberInDEV (node_modules/react-dom/cjs/react-dom-client.development.js:874:13)
      at warnIfUpdatesNotWrappedWithActDEV (node_modules/react-dom/cjs/react-dom-client.development.js:18757:9)
      at scheduleUpdateOnFiber (node_modules/react-dom/cjs/react-dom-client.development.js:16409:11)
      at dispatchSetStateInternal (node_modules/react-dom/cjs/react-dom-client.development.js:9170:13)
      at dispatchSetState (node_modules/react-dom/cjs/react-dom-client.development.js:9127:7)
      at setLoadingMessages (components/editor/ChatBox.tsx:72:7)

  ● ChatBox › Message Display › should display messages after loading

    Unable to find an element with the text: Hello, can you help me?. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      222 |     it('should display messages after loading', async () => {
      223 |       render(<ChatBox {...defaultProps} />);
    > 224 |       await waitFor(() => {
          |                    ^
      225 |         expect(screen.getByText('Hello, can you help me?')).toBeInTheDocument();
      226 |         expect(screen.getByText('Of course! How can I assist you today?')).toBeInTheDocument();
      227 |       });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:224:20)

  ● ChatBox › Message Display › should display message timestamps

    Unable to find an element with the text: /\d{1,2}:\d{2}/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      240 |     it('should display message timestamps', async () => {
      241 |       render(<ChatBox {...defaultProps} />);
    > 242 |       await waitFor(() => {
          |                    ^
      243 |         const timestamps = screen.getAllByText(/\d{1,2}:\d{2}/);
      244 |         expect(timestamps.length).toBeGreaterThan(0);
      245 |       });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:242:20)

  ● ChatBox › Message Display › should style user messages differently from assistant messages

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
          [36m>[39m
            [36m<input[39m
              [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
              [33mclass[39m=[32m"hidden"[39m
              [33mmultiple[39m=[32m""[39m
              [33mtype[39m=[32m"file"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-3"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
                [36m>[39m
                  [0mDreamReal Assistant[0m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-flash-latest"[39m
                  [36m>[39m
                    [0mGemini Flash[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                  [36m>[39m
                    [0mGemini Pro[0m
                  [36m</option>[39m
                [36m</select>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Clear chat history"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                  [33mtitle[39m=[32m"Clear chat history"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
                [36m>[39m
                  [0mStart a conversation[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
                [36m>[39m
                  [0mAsk me anything about your video project[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div />[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex gap-2"[39m
              [36m>[39m
                [36m<textarea[39m
                  [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                  [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                  [33mrows[39m=[32m"2"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex flex-col gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Send message"[39m
                    [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtitle[39m=[32m"Send message"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Attach files"[39m
                    [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                    [33mtitle[39m=[32m"Attach files"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      252 |         const assistantMessages = container.querySelectorAll('.bg-neutral-100');
      253 |         expect(userMessages.length).toBeGreaterThan(0);
    > 254 |         expect(assistantMessages.length).toBeGreaterThan(0);
          |                                          ^
      255 |       });
      256 |     });
      257 |   });

      at toBeGreaterThan (__tests__/components/editor/ChatBox.test.tsx:254:42)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● ChatBox › Message Sending › should send message on button click

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/ai/chat", Any<Object>
    Received
           1: "/api/projects/test-project/chat"
           2: "/api/projects/test-project/chat/messages", {"body": "{\"role\":\"user\",\"content\":\"Test message\",\"model\":\"gemini-flash-latest\",\"attachments\":null}", "headers": {"Content-Type": "application/json"}, "method": "POST"}

    Number of calls: 2

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
          [36m>[39m
            [36m<input[39m
              [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
              [33mclass[39m=[32m"hidden"[39m
              [33mmultiple[39m=[32m""[39m
              [33mtype[39m=[32m"file"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-3"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
                [36m>[39m
                  [0mDreamReal Assistant[0m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-flash-latest"[39m
                  [36m>[39m
                    [0mGemini Flash[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                  [36m>[39m
                    [0mGemini Pro[0m
                  [36m</option>[39m
                [36m</select>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Clear chat history"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                  [33mtitle[39m=[32m"Clear chat history"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
                [36m>[39m
                  [0mStart a conversation[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
                [36m>[39m
                  [0mAsk me anything about your video project[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div />[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex gap-2"[39m
              [36m>[39m
                [36m<textarea[39m
                  [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                  [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                  [33mrows[39m=[32m"2"[39m
                [36m>[39m
                  [0mTest message[0m
                [36m</textarea>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex flex-col gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Send message"[39m
                    [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                    [33mtitle[39m=[32m"Send message"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Attach files"[39m
                    [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                    [33mtitle[39m=[32m"Attach files"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      332 |       await user.click(sendButton);
      333 |       await waitFor(() => {
    > 334 |         expect(global.fetch).toHaveBeenCalledWith('/api/ai/chat', expect.any(Object));
          |                              ^
      335 |       });
      336 |     });
      337 |

      at toHaveBeenCalledWith (__tests__/components/editor/ChatBox.test.tsx:334:30)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● ChatBox › Message Sending › should send message on Enter key press

    expect(element).toHaveValue()

    Expected the element to have value:

    Received:
      Test message

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
          [36m>[39m
            [36m<input[39m
              [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
              [33mclass[39m=[32m"hidden"[39m
              [33mmultiple[39m=[32m""[39m
              [33mtype[39m=[32m"file"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-3"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
                [36m>[39m
                  [0mDreamReal Assistant[0m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-flash-latest"[39m
                  [36m>[39m
                    [0mGemini Flash[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                  [36m>[39m
                    [0mGemini Pro[0m
                  [36m</option>[39m
                [36m</select>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Clear chat history"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                  [33mtitle[39m=[32m"Clear chat history"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
                [36m>[39m
                  [0mStart a conversation[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
                [36m>[39m
                  [0mAsk me anything about your video project[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div />[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex gap-2"[39m
              [36m>[39m
                [36m<textarea[39m
                  [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                  [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                  [33mrows[39m=[32m"2"[39m
                [36m>[39m
                  [0mTest message[0m
                [36m</textarea>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex flex-col gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Send message"[39m
                    [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                    [33mtitle[39m=[32m"Send message"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Attach files"[39m
                    [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                    [33mtitle[39m=[32m"Attach files"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      349 |       // Message should be cleared after sending
      350 |       await waitFor(() => {
    > 351 |         expect(input).toHaveValue('');
          |                       ^
      352 |       });
      353 |     });
      354 |

      at toHaveValue (__tests__/components/editor/ChatBox.test.tsx:351:23)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● ChatBox › File Attachments › should create blob URLs when files are attached

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {}

    Number of calls: 0

      407 |       });
      408 |
    > 409 |       expect(mockCreateObjectURL).toHaveBeenCalledWith(testFile);
          |                                   ^
      410 |       await waitFor(() => {
      411 |         expect(screen.getByText('test.png')).toBeInTheDocument();
      412 |       });

      at Object.toHaveBeenCalledWith (__tests__/components/editor/ChatBox.test.tsx:409:35)

  ● ChatBox › Clear Chat › should not clear chat if user cancels

    Unable to find an element with the text: Hello, can you help me?. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      483 |
      484 |       // Messages should still be present
    > 485 |       await waitFor(() => {
          |                    ^
      486 |         expect(screen.getByText('Hello, can you help me?')).toBeInTheDocument();
      487 |       });
      488 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:485:20)

  ● ChatBox › Loading States › should show loading indicator when sending message

    Unable to find an element with the text: (content, element)=>{ return element?.className.includes('animate-bounce') ?? false; } (normalized from '(content, element)=>{
                        return element?.className.includes('animate-bounce') ?? false;
                    }'), which matches selector 'div'. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-center py-8"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2 text-sm text-neutral-500"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 animate-spin"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<circle[39m
                    [33mclass[39m=[32m"opacity-25"[39m
                    [33mcx[39m=[32m"12"[39m
                    [33mcy[39m=[32m"12"[39m
                    [33mr[39m=[32m"10"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"4"[39m
                  [36m/>[39m
                  [36m<path[39m
                    [33mclass[39m=[32m"opacity-75"[39m
                    [33md[39m=[32m"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"[39m
                    [33mfill[39m=[32m"currentColor"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [0mLoading...[0m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m>[39m
                [0mTest message[0m
              [36m</textarea>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      519 |
      520 |       // Should show loading dots
    > 521 |       await waitFor(
          |                    ^
      522 |         () => {
      523 |           const loadingDots = screen.getByText(
      524 |             (content, element) => {

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:521:20)

  ● ChatBox › Error Handling › should display error message when API fails

    Unable to find an element with the text: Sorry, I encountered an error processing your request.. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m>[39m
                [0mTest message[0m
              [36m</textarea>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      554 |       await user.click(sendButton);
      555 |
    > 556 |       await waitFor(() => {
          |                    ^
      557 |         expect(
      558 |           screen.getByText('Sorry, I encountered an error processing your request.')
      559 |         ).toBeInTheDocument();

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:556:20)

A worker process has failed to exit gracefully and has been force exited. This is likely caused by tests leaking due to improper teardown. Try running with --detectOpenHandles to find leaks. Active timers can also cause this, ensure that .unref() was called on them.
Summary of all failing tests
FAIL __tests__/api/projects/create.test.ts
  ● POST /api/projects › Authentication › should return 401 when user is not authenticated

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:76:34)

  ● POST /api/projects › Authentication › should return 401 when auth error occurs

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:93:34)

  ● POST /api/projects › Success Cases › should create a project with custom title

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:113:34)

  ● POST /api/projects › Success Cases › should create a project with default title when no title provided

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:140:34)

  ● POST /api/projects › Success Cases › should create a project with empty timeline state

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:162:34)

  ● POST /api/projects › Error Handling › should return 500 when database insert fails

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:180:34)

  ● POST /api/projects › Error Handling › should return 500 when unexpected error occurs

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:198:34)

  ● POST /api/projects › Error Handling › should handle malformed JSON body

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:213:34)

  ● POST /api/projects › Data Validation › should accept empty title and use default

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:233:34)

  ● POST /api/projects › Data Validation › should trim whitespace from title

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:256:34)

  ● POST /api/projects › Data Validation › should accept very long titles

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:275:34)

  ● POST /api/projects › Response Format › should return complete project object

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:297:34)

  ● POST /api/projects › Response Format › should return correct content-type header

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:318:34)

  ● POST /api/projects › Database Interactions › should call database methods in correct order

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:335:17)

  ● POST /api/projects › Database Interactions › should use select().single() chain

    TypeError: Cannot read properties of undefined (reading 'params')

      92 |
      93 |     // Handle Next.js 15's async params
    > 94 |     const params = (await context.params) as TParams;
         |                                   ^
      95 |
      96 |     try {
      97 |       serverLogger.info(

      at params (lib/api/withAuth.ts:94:35)
      at Object.<anonymous> (__tests__/api/projects/create.test.ts:353:17)

FAIL __tests__/api/assets/upload.test.ts
  ● POST /api/assets/upload › Input Validation › should return 400 when no file provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      93 |       const response = await POST(mockRequest);
      94 |
    > 95 |       expect(response.status).toBe(400);
         |                               ^
      96 |       const data = await response.json();
      97 |       expect(data.error).toBe('No file provided');
      98 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:95:31)

  ● POST /api/assets/upload › Input Validation › should return 400 when no projectId provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      111 |       const response = await POST(mockRequest);
      112 |
    > 113 |       expect(response.status).toBe(400);
          |                               ^
      114 |       const data = await response.json();
      115 |       expect(data.error).toBe('Project ID required');
      116 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:113:31)

  ● POST /api/assets/upload › Input Validation › should return 400 when file exceeds size limit

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      140 |       const response = await POST(mockRequest);
      141 |
    > 142 |       expect(response.status).toBe(400);
          |                               ^
      143 |       const data = await response.json();
      144 |       expect(data.error).toBe('File too large');
      145 |       expect(data.details).toContain('100MB');

      at Object.toBe (__tests__/api/assets/upload.test.ts:142:31)

  ● POST /api/assets/upload › Input Validation › should return 400 for invalid image MIME type

    expect(received).toBe(expected) // Object.is equality

    Expected: 400
    Received: 500

      162 |       const response = await POST(mockRequest);
      163 |
    > 164 |       expect(response.status).toBe(400);
          |                               ^
      165 |       const data = await response.json();
      166 |       expect(data.error).toBe('Invalid file type');
      167 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:164:31)

  ● POST /api/assets/upload › Input Validation › should accept valid image MIME types

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      193 |
      194 |         const response = await POST(mockRequest);
    > 195 |         expect(response.status).toBe(200);
          |                                 ^
      196 |       }
      197 |     });
      198 |

      at Object.toBe (__tests__/api/assets/upload.test.ts:195:33)

  ● POST /api/assets/upload › Input Validation › should accept valid video MIME types

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      224 |
      225 |         const response = await POST(mockRequest);
    > 226 |         expect(response.status).toBe(200);
          |                                 ^
      227 |       }
      228 |     });
      229 |   });

      at Object.toBe (__tests__/api/assets/upload.test.ts:226:33)

  ● POST /api/assets/upload › Project Authorization › should return 404 when project not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 500

      251 |       const response = await POST(mockRequest);
      252 |
    > 253 |       expect(response.status).toBe(404);
          |                               ^
      254 |       const data = await response.json();
      255 |       expect(data.error).toContain('not found');
      256 |     });

      at Object.toBe (__tests__/api/assets/upload.test.ts:253:31)

  ● POST /api/assets/upload › Project Authorization › should return 404 when user does not own project

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 500

      280 |       const response = await POST(mockRequest);
      281 |
    > 282 |       expect(response.status).toBe(404);
          |                               ^
      283 |     });
      284 |
      285 |     it('should verify project ownership with user_id', async () => {

      at Object.toBe (__tests__/api/assets/upload.test.ts:282:31)

  ● POST /api/assets/upload › Project Authorization › should verify project ownership with user_id

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "id", "test-project-id"

    Number of calls: 0

      307 |       await POST(mockRequest);
      308 |
    > 309 |       expect(mockSupabase.eq).toHaveBeenCalledWith('id', 'test-project-id');
          |                               ^
      310 |       expect(mockSupabase.eq).toHaveBeenCalledWith('user_id', mockUser.id);
      311 |     });
      312 |   });

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:309:31)

  ● POST /api/assets/upload › File Upload Success › should upload file and create asset record

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      337 |       const response = await POST(mockRequest);
      338 |
    > 339 |       expect(response.status).toBe(200);
          |                               ^
      340 |       expect(mockSupabase.storage.upload).toHaveBeenCalled();
      341 |       expect(mockSupabase.insert).toHaveBeenCalledWith(
      342 |         expect.objectContaining({

      at Object.toBe (__tests__/api/assets/upload.test.ts:339:31)

  ● POST /api/assets/upload › File Upload Success › should generate unique filename with UUID

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringMatching /mock-uuid-123\./, Any<Buffer>, Any<Object>

    Number of calls: 0

      374 |       await POST(mockRequest);
      375 |
    > 376 |       expect(mockSupabase.storage.upload).toHaveBeenCalledWith(
          |                                           ^
      377 |         expect.stringMatching(/mock-uuid-123\./),
      378 |         expect.any(Buffer),
      379 |         expect.any(Object)

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:376:43)

  ● POST /api/assets/upload › File Upload Success › should organize files in correct folder structure

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: StringContaining "test-user-id/test-project-id/image/", Any<Buffer>, Any<Object>

    Number of calls: 0

      406 |       await POST(mockRequest);
      407 |
    > 408 |       expect(mockSupabase.storage.upload).toHaveBeenCalledWith(
          |                                           ^
      409 |         expect.stringContaining(`${mockUser.id}/test-project-id/image/`),
      410 |         expect.any(Buffer),
      411 |         expect.any(Object)

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:408:43)

  ● POST /api/assets/upload › File Upload Success › should return asset information in response

    expect(received).toHaveProperty(path)

    Expected path: "assetId"
    Received path: []

    Received value: {"error": "(0 , _supabase.isSupabaseServiceConfigured) is not a function"}

      438 |       const data = await response.json();
      439 |
    > 440 |       expect(data).toHaveProperty('assetId');
          |                    ^
      441 |       expect(data).toHaveProperty('storageUrl');
      442 |       expect(data).toHaveProperty('publicUrl');
      443 |       expect(data).toHaveProperty('success', true);

      at Object.toHaveProperty (__tests__/api/assets/upload.test.ts:440:20)

  ● POST /api/assets/upload › Error Handling › should return 500 when storage upload fails

    expect(received).toBe(expected) // Object.is equality

    Expected: "Storage quota exceeded"
    Received: "(0 , _supabase.isSupabaseServiceConfigured) is not a function"

      470 |       expect(response.status).toBe(500);
      471 |       const data = await response.json();
    > 472 |       expect(data.error).toBe('Storage quota exceeded');
          |                          ^
      473 |     });
      474 |
      475 |     it('should delete uploaded file when database insert fails', async () => {

      at Object.toBe (__tests__/api/assets/upload.test.ts:472:26)

  ● POST /api/assets/upload › Error Handling › should delete uploaded file when database insert fails

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

      504 |
      505 |       expect(response.status).toBe(500);
    > 506 |       expect(mockSupabase.storage.remove).toHaveBeenCalled();
          |                                           ^
      507 |     });
      508 |
      509 |     it('should handle unexpected errors', async () => {

      at Object.toHaveBeenCalled (__tests__/api/assets/upload.test.ts:506:43)

  ● POST /api/assets/upload › Error Handling › should handle unexpected errors

    expect(received).toBe(expected) // Object.is equality

    Expected: "Internal server error"
    Received: "(0 , _supabase.isSupabaseServiceConfigured) is not a function"

      532 |       expect(response.status).toBe(500);
      533 |       const data = await response.json();
    > 534 |       expect(data.error).toBe('Internal server error');
          |                          ^
      535 |     });
      536 |   });
      537 |

      at Object.toBe (__tests__/api/assets/upload.test.ts:534:26)

  ● POST /api/assets/upload › Activity History › should log upload to activity history

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"activity_type": "image_upload", "project_id": "test-project-id", "user_id": "test-user-id"}

    Number of calls: 0

      561 |       await POST(mockRequest);
      562 |
    > 563 |       expect(mockSupabase.insert).toHaveBeenCalledWith(
          |                                   ^
      564 |         expect.objectContaining({
      565 |           activity_type: 'image_upload',
      566 |           user_id: mockUser.id,

      at Object.toHaveBeenCalledWith (__tests__/api/assets/upload.test.ts:563:35)

FAIL __tests__/api/video/generate.test.ts
  ● POST /api/video/generate › Project Ownership Verification › should return 404 when project not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      246 |       const response = await POST(mockRequest);
      247 |
    > 248 |       expect(response.status).toBe(404);
          |                               ^
      249 |     });
      250 |
      251 |     it('should return 403 when user does not own project', async () => {

      at Object.toBe (__tests__/api/video/generate.test.ts:248:31)

  ● POST /api/video/generate › Project Ownership Verification › should return 403 when user does not own project

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

      268 |       const response = await POST(mockRequest);
      269 |
    > 270 |       expect(response.status).toBe(403);
          |                               ^
      271 |     });
      272 |   });
      273 |

      at Object.toBe (__tests__/api/video/generate.test.ts:270:31)

  ● POST /api/video/generate › Video Generation - Google Veo › should generate video with Veo for Google models

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      294 |       const response = await POST(mockRequest);
      295 |
    > 296 |       expect(response.status).toBe(200);
          |                               ^
      297 |       const data = await response.json();
      298 |       expect(data.operationName).toBe('operations/veo-123');
      299 |       expect(data.status).toBe('processing');

      at Object.toBe (__tests__/api/video/generate.test.ts:296:31)

  ● POST /api/video/generate › Video Generation - Google Veo › should pass all Veo parameters correctly

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"compressionQuality": "high", "enhancePrompt": true, "generateAudio": true, "model": "veo-3.1-generate-preview", "negativePrompt": "blurry, low quality", "personGeneration": true, "prompt": "Test video", "sampleCount": 2, "seed": 12345}

    Number of calls: 0

      337 |       await POST(mockRequest);
      338 |
    > 339 |       expect(generateVideo).toHaveBeenCalledWith(
          |                             ^
      340 |         expect.objectContaining({
      341 |           prompt: 'Test video',
      342 |           model: 'veo-3.1-generate-preview',

      at Object.toHaveBeenCalledWith (__tests__/api/video/generate.test.ts:339:29)

  ● POST /api/video/generate › Video Generation - FAL Models › should use FAL for Seedance model

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      376 |       const response = await POST(mockRequest);
      377 |
    > 378 |       expect(response.status).toBe(200);
          |                               ^
      379 |       const data = await response.json();
      380 |       expect(data.operationName).toBe('fal:seedance-1.0-pro:fal-request-123');
      381 |       expect(generateFalVideo).toHaveBeenCalled();

      at Object.toBe (__tests__/api/video/generate.test.ts:378:31)

  ● POST /api/video/generate › Video Generation - FAL Models › should use FAL for MiniMax model

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      404 |       const response = await POST(mockRequest);
      405 |
    > 406 |       expect(response.status).toBe(200);
          |                               ^
      407 |       const data = await response.json();
      408 |       expect(data.operationName).toContain('minimax-hailuo-02-pro');
      409 |     });

      at Object.toBe (__tests__/api/video/generate.test.ts:406:31)

  ● POST /api/video/generate › Image-to-Video Generation › should generate video from image asset

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"auth": {"getUser": [Function mockConstructor], "signOut": [Function mockConstructor]}, "channel": [Function mockConstructor], "delete": [Function mockConstructor], "eq": [Function mockConstructor], "from": [Function mockConstructor], "insert": [Function mockConstructor], "limit": [Function mockConstructor], "maybeSingle": [Function mockConstructor], "neq": [Function mockConstructor], "order": [Function mockConstructor], "removeChannel": [Function mockConstructor], "select": [Function mockConstructor], "single": [Function mockConstructor], "storage": {"createSignedUrl": [Function mockConstructor], "from": [Function mockConstructor], "getPublicUrl": [Function mockConstructor], "remove": [Function mockConstructor], "upload": [Function mockConstructor]}, "update": [Function mockConstructor]}, "image-asset-id", Any<String>

    Number of calls: 0

      449 |       await POST(mockRequest);
      450 |
    > 451 |       expect(verifyAssetOwnership).toHaveBeenCalledWith(
          |                                    ^
      452 |         mockSupabase,
      453 |         'image-asset-id',
      454 |         expect.any(String)

      at Object.toHaveBeenCalledWith (__tests__/api/video/generate.test.ts:451:36)

  ● POST /api/video/generate › Image-to-Video Generation › should return 404 when image asset not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      485 |       const response = await POST(mockRequest);
      486 |
    > 487 |       expect(response.status).toBe(404);
          |                               ^
      488 |     });
      489 |   });
      490 |

      at Object.toBe (__tests__/api/video/generate.test.ts:487:31)

  ● POST /api/video/generate › Error Handling › should return 500 when video generation fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

      509 |       const response = await POST(mockRequest);
      510 |
    > 511 |       expect(response.status).toBe(500);
          |                               ^
      512 |       const data = await response.json();
      513 |       expect(data.error).toBe('API error');
      514 |     });

      at Object.toBe (__tests__/api/video/generate.test.ts:511:31)

  ● POST /api/video/generate › Error Handling › should handle malformed JSON body

    SyntaxError: Unexpected token 'i', "invalid json" is not valid JSON
        at JSON.parse (<anonymous>)

      at parseJSONFromBytes (node_modules/undici/lib/web/fetch/body.js:504:15)
      at successSteps (node_modules/undici/lib/web/fetch/body.js:465:23)
      at readAllBytes (node_modules/undici/lib/web/fetch/util.js:1030:9)

  ● POST /api/video/generate › Response Format › should return operationName and status

    expect(received).toHaveProperty(path)

    Expected path: "operationName"
    Received path: []

    Received value: {"error": "Prompt is required", "field": "prompt"}

      549 |       const data = await response.json();
      550 |
    > 551 |       expect(data).toHaveProperty('operationName');
          |                    ^
      552 |       expect(data).toHaveProperty('status', 'processing');
      553 |       expect(data).toHaveProperty('message');
      554 |     });

      at Object.toHaveProperty (__tests__/api/video/generate.test.ts:551:20)

FAIL __tests__/api/video/upscale.test.ts
  ● POST /api/video/upscale › Authentication › should return 401 when user is not authenticated

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 400

       98 |       const response = await POST(mockRequest);
       99 |
    > 100 |       expect(response.status).toBe(401);
          |                               ^
      101 |     });
      102 |   });
      103 |

      at Object.toBe (__tests__/api/video/upscale.test.ts:100:31)

  ● POST /api/video/upscale › Rate Limiting › should return 429 when rate limit exceeded

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 400

      155 |       const response = await POST(mockRequest);
      156 |
    > 157 |       expect(response.status).toBe(429);
          |                               ^
      158 |     });
      159 |   });
      160 |

      at Object.toBe (__tests__/api/video/upscale.test.ts:157:31)

  ● POST /api/video/upscale › Success Cases › should submit upscale request successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      179 |       const response = await POST(mockRequest);
      180 |
    > 181 |       expect(response.status).toBe(200);
          |                               ^
      182 |       const data = await response.json();
      183 |       expect(data.requestId).toBe('upscale-request-123');
      184 |       expect(data.message).toContain('successfully');

      at Object.toBe (__tests__/api/video/upscale.test.ts:181:31)

  ● POST /api/video/upscale › Error Handling › should return 500 when FAL_API_KEY is not configured

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

      201 |       const response = await POST(mockRequest);
      202 |
    > 203 |       expect(response.status).toBe(500);
          |                               ^
      204 |     });
      205 |
      206 |     it('should handle FAL API errors', async () => {

      at Object.toBe (__tests__/api/video/upscale.test.ts:203:31)

  ● POST /api/video/upscale › Error Handling › should handle FAL API errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 400

      223 |       const response = await POST(mockRequest);
      224 |
    > 225 |       expect(response.status).toBe(500);
          |                               ^
      226 |     });
      227 |
      228 |     it('should handle timeout errors', async () => {

      at Object.toBe (__tests__/api/video/upscale.test.ts:225:31)

  ● POST /api/video/upscale › Error Handling › should handle timeout errors

    expect(received).toBe(expected) // Object.is equality

    Expected: 504
    Received: 400

      241 |       const response = await POST(mockRequest);
      242 |
    > 243 |       expect(response.status).toBe(504);
          |                               ^
      244 |     });
      245 |   });
      246 | });

      at Object.toBe (__tests__/api/video/upscale.test.ts:243:31)

FAIL __tests__/api/projects/delete.test.ts
  ● DELETE /api/projects/[projectId] › Success Cases › should delete project successfully with valid ID

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      140 |       });
      141 |
    > 142 |       expect(response.status).toBe(200);
          |                               ^
      143 |       const data = await response.json();
      144 |       expect(data.success).toBe(true);
      145 |       expect(mockSupabase.from).toHaveBeenCalledWith('projects');

      at Object.toBe (__tests__/api/projects/delete.test.ts:142:31)

  ● DELETE /api/projects/[projectId] › Success Cases › should delete project and cascade delete related resources

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      163 |       });
      164 |
    > 165 |       expect(response.status).toBe(200);
          |                               ^
      166 |       const data = await response.json();
      167 |       expect(data.success).toBe(true);
      168 |     });

      at Object.toBe (__tests__/api/projects/delete.test.ts:165:31)

  ● DELETE /api/projects/[projectId] › Error Handling › should return 500 when database delete fails

    expect(received).toBe(expected) // Object.is equality

    Expected: "Failed to delete project"
    Received: "Internal server error"

      187 |       expect(response.status).toBe(500);
      188 |       const data = await response.json();
    > 189 |       expect(data.error).toBe('Failed to delete project');
          |                          ^
      190 |     });
      191 |
      192 |     it('should return 500 when unexpected error occurs', async () => {

      at Object.toBe (__tests__/api/projects/delete.test.ts:189:26)

  ● DELETE /api/projects/[projectId] › Authorization › should respect RLS and only delete projects owned by user

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      226 |       });
      227 |
    > 228 |       expect(response.status).toBe(200);
          |                               ^
      229 |       expect(mockSupabase.from).toHaveBeenCalledWith('projects');
      230 |     });
      231 |   });

      at Object.toBe (__tests__/api/projects/delete.test.ts:228:31)

  ● DELETE /api/projects/[projectId] › Database Interactions › should call database methods in correct order

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "id", "test-project-id"

    Number of calls: 0

      249 |       expect(mockSupabase.from).toHaveBeenCalledWith('projects');
      250 |       expect(mockSupabase.delete).toHaveBeenCalled();
    > 251 |       expect(mockSupabase.eq).toHaveBeenCalledWith('id', 'test-project-id');
          |                               ^
      252 |     });
      253 |   });
      254 |

      at Object.toHaveBeenCalledWith (__tests__/api/projects/delete.test.ts:251:31)

  ● DELETE /api/projects/[projectId] › Response Format › should return success boolean on successful deletion

    expect(received).toHaveProperty(path)

    Expected path: "success"
    Received path: []

    Received value: {"error": "Internal server error"}

      270 |       const data = await response.json();
      271 |
    > 272 |       expect(data).toHaveProperty('success');
          |                    ^
      273 |       expect(data.success).toBe(true);
      274 |     });
      275 |

      at Object.toHaveProperty (__tests__/api/projects/delete.test.ts:272:20)

FAIL __tests__/api/audio/elevenlabs/generate.test.ts
  ● POST /api/audio/elevenlabs/generate › Authentication › should return 401 when user is not authenticated

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:77:24)

  ● POST /api/audio/elevenlabs/generate › Validation › should return 400 for missing text

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:93:24)

  ● POST /api/audio/elevenlabs/generate › Validation › should return 400 for text exceeding max length

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:108:24)

  ● POST /api/audio/elevenlabs/generate › Success Cases › should generate audio successfully

    TypeError: Cannot destructure property 'data' of '(intermediate value)' as it is undefined.

      14 | const createMockHandler = () => async (req: NextRequest) => {
      15 |   const mockSupabase = createMockSupabaseClient();
    > 16 |   const { data: { user } } = await mockSupabase.auth.getUser();
         |                 ^
      17 |   
      18 |   if (!user) {
      19 |     return new Response(JSON.stringify({ error: 'Unauthorized' }), { 

      at __tests__/api/audio/elevenlabs/generate.test.ts:16:17
      at Object.<anonymous> (__tests__/api/audio/elevenlabs/generate.test.ts:125:24)

FAIL __tests__/api/assets/sign.test.ts
  ● GET /api/assets/sign › Input Validation › should return 400 when storageUrl is invalid

    expect(received).toBe(expected) // Object.is equality

    Expected: "Invalid storage URL"
    Received: "Invalid storage URL format. Must start with supabase://"

      84 |       expect(response.status).toBe(400);
      85 |       const data = await response.json();
    > 86 |       expect(data.error).toBe('Invalid storage URL');
         |                          ^
      87 |     });
      88 |
      89 |     it('should accept valid supabase:// storage URLs', async () => {

      at Object.toBe (__tests__/api/assets/sign.test.ts:86:26)

  ● GET /api/assets/sign › Asset Lookup by assetId › should fetch storageUrl from database when assetId provided

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      117 |       const response = await GET(mockRequest);
      118 |
    > 119 |       expect(response.status).toBe(200);
          |                               ^
      120 |       expect(mockSupabase.select).toHaveBeenCalledWith('storage_url, user_id');
      121 |       expect(mockSupabase.eq).toHaveBeenCalledWith('id', 'asset-123');
      122 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:119:31)

  ● GET /api/assets/sign › Asset Lookup by assetId › should return 404 when asset not found

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      133 |       const response = await GET(mockRequest);
      134 |
    > 135 |       expect(response.status).toBe(404);
          |                               ^
      136 |       const data = await response.json();
      137 |       expect(data.error).toBe('Asset not found');
      138 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:135:31)

  ● GET /api/assets/sign › Asset Lookup by assetId › should return 403 when asset belongs to different user

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 400

      154 |       const response = await GET(mockRequest);
      155 |
    > 156 |       expect(response.status).toBe(403);
          |                               ^
      157 |       const data = await response.json();
      158 |       expect(data.error).toContain('asset does not belong to user');
      159 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:156:31)

  ● GET /api/assets/sign › Asset Authorization by storageUrl › should skip folder check when assetId was used for lookup

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      202 |       const response = await GET(mockRequest);
      203 |
    > 204 |       expect(response.status).toBe(200);
          |                               ^
      205 |     });
      206 |   });
      207 |

      at Object.toBe (__tests__/api/assets/sign.test.ts:204:31)

  ● GET /api/assets/sign › Storage Bucket Handling › should handle different storage buckets

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "custom-bucket"

    Number of calls: 0

      285 |       await GET(mockRequest);
      286 |
    > 287 |       expect(mockSupabase.storage.from).toHaveBeenCalledWith('custom-bucket');
          |                                         ^
      288 |     });
      289 |
      290 |     it('should handle paths with multiple slashes', async () => {

      at Object.toHaveBeenCalledWith (__tests__/api/assets/sign.test.ts:287:41)

  ● GET /api/assets/sign › Error Handling › should return 500 when database query fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 404
    Received: 400

      333 |       const response = await GET(mockRequest);
      334 |
    > 335 |       expect(response.status).toBe(404);
          |                               ^
      336 |     });
      337 |
      338 |     it('should handle unexpected errors gracefully', async () => {

      at Object.toBe (__tests__/api/assets/sign.test.ts:335:31)

  ● GET /api/assets/sign › Error Handling › should handle unexpected errors gracefully

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 403

      348 |       const response = await GET(mockRequest);
      349 |
    > 350 |       expect(response.status).toBe(500);
          |                               ^
      351 |       const data = await response.json();
      352 |       expect(data.error).toBe('Internal server error');
      353 |     });

      at Object.toBe (__tests__/api/assets/sign.test.ts:350:31)

FAIL __tests__/api/assets/get.test.ts
  ● GET /api/assets › Success Cases › should return all assets for authenticated user

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      78 |         count: mockAssets.length,
      79 |       });
    > 80 |       mockSupabase.range.mockResolvedValue({
         |                          ^
      81 |         data: mockAssets,
      82 |         error: null,
      83 |         count: mockAssets.length,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:80:26)

  ● GET /api/assets › Success Cases › should filter assets by projectId

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

       98 |       const mockAssets = [createMockAsset({ project_id: 'project-1' })];
       99 |
    > 100 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      101 |         data: mockAssets,
      102 |         error: null,
      103 |         count: 1,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:100:26)

  ● GET /api/assets › Success Cases › should filter assets by type

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      116 |       const mockAssets = [createMockAsset({ type: 'video' })];
      117 |
    > 118 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      119 |         data: mockAssets,
      120 |         error: null,
      121 |         count: 1,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:118:26)

  ● GET /api/assets › Success Cases › should support pagination

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      132 |     it('should support pagination', async () => {
      133 |       mockAuthenticatedUser(mockSupabase);
    > 134 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      135 |         data: [],
      136 |         error: null,
      137 |         count: 100,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:134:26)

  ● GET /api/assets › Error Handling › should return 500 on database error

    TypeError: Cannot read properties of undefined (reading 'mockResolvedValue')

      188 |     it('should return 500 on database error', async () => {
      189 |       mockAuthenticatedUser(mockSupabase);
    > 190 |       mockSupabase.range.mockResolvedValue({
          |                          ^
      191 |         data: null,
      192 |         error: { message: 'Database error', code: 'DB_ERROR' },
      193 |         count: null,

      at Object.mockResolvedValue (__tests__/api/assets/get.test.ts:190:26)

FAIL __tests__/api/export/export.test.ts
  ● POST /api/export › Success Cases › should create export job successfully

    expect(received).toBe(expected) // Object.is equality

    Expected: 202
    Received: 400

      123 |
      124 |       const response = await POST(mockRequest);
    > 125 |       expect(response.status).toBe(202);
          |                               ^
      126 |       const data = await response.json();
      127 |       expect(data.jobId).toBe('job-123');
      128 |       expect(data.status).toBe('queued');

      at Object.toBe (__tests__/api/export/export.test.ts:125:31)

  ● GET /api/export › Success Cases › should get export job status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 400

      160 |       const response = await GET(mockRequest);
      161 |
    > 162 |       expect(response.status).toBe(200);
          |                               ^
      163 |     });
      164 |   });
      165 | });

      at Object.toBe (__tests__/api/export/export.test.ts:162:31)

FAIL __tests__/api/payments/checkout.test.ts
  ● POST /api/stripe/checkout › Stripe Customer Creation › should create new Stripe customer when not exists

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"email": "test@example.com", "stripeCustomerId": null, "userId": "test-user-id"}

    Number of calls: 0

      201 |       await POST(mockRequest);
      202 |
    > 203 |       expect(getOrCreateStripeCustomer).toHaveBeenCalledWith({
          |                                         ^
      204 |         userId: mockUser.id,
      205 |         email: mockUser.email,
      206 |         stripeCustomerId: null,

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:203:41)

  ● POST /api/stripe/checkout › Stripe Customer Creation › should use existing Stripe customer when available

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"email": "test@example.com", "stripeCustomerId": "cus_existing_123", "userId": "test-user-id"}

    Number of calls: 0

      232 |       await POST(mockRequest);
      233 |
    > 234 |       expect(getOrCreateStripeCustomer).toHaveBeenCalledWith({
          |                                         ^
      235 |         userId: mockUser.id,
      236 |         email: mockUser.email,
      237 |         stripeCustomerId: 'cus_existing_123',

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:234:41)

  ● POST /api/stripe/checkout › Checkout Session Creation › should create checkout session with default price

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {"cancelUrl": StringContaining "/settings", "customerId": "cus_test_123", "priceId": "price_test_premium", "successUrl": StringContaining "/settings?session_id=", "userId": "test-user-id"}

    Number of calls: 0

      262 |       const response = await POST(mockRequest);
      263 |
    > 264 |       expect(createCheckoutSession).toHaveBeenCalledWith({
          |                                     ^
      265 |         customerId: 'cus_test_123',
      266 |         priceId: 'price_test_premium',
      267 |         userId: mockUser.id,

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:264:37)

  ● POST /api/stripe/checkout › Checkout Session Creation › should create checkout session with custom price

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"priceId": "price_custom_123"}

    Number of calls: 0

      295 |       await POST(mockRequest);
      296 |
    > 297 |       expect(createCheckoutSession).toHaveBeenCalledWith(
          |                                     ^
      298 |         expect.objectContaining({
      299 |           priceId: 'price_custom_123',
      300 |         })

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:297:37)

  ● POST /api/stripe/checkout › Checkout Session Creation › should return 500 when price ID not configured

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 429

      322 |       const response = await POST(mockRequest);
      323 |
    > 324 |       expect(response.status).toBe(500);
          |                               ^
      325 |       const data = await response.json();
      326 |       expect(data.error).toBe('Price ID not configured');
      327 |     });

      at Object.toBe (__tests__/api/payments/checkout.test.ts:324:31)

  ● POST /api/stripe/checkout › Error Handling › should return 500 when Stripe API fails

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 429

      348 |       const response = await POST(mockRequest);
      349 |
    > 350 |       expect(response.status).toBe(500);
          |                               ^
      351 |       const data = await response.json();
      352 |       expect(data.error).toBe('Failed to create checkout session');
      353 |     });

      at Object.toBe (__tests__/api/payments/checkout.test.ts:350:31)

  ● POST /api/stripe/checkout › Error Handling › should handle malformed JSON body

    expect(received).toBe(expected) // Object.is equality

    Expected: 500
    Received: 429

      365 |       const response = await POST(mockRequest);
      366 |
    > 367 |       expect(response.status).toBe(500);
          |                               ^
      368 |     });
      369 |   });
      370 |

      at Object.toBe (__tests__/api/payments/checkout.test.ts:367:31)

  ● POST /api/stripe/checkout › Response Format › should return sessionId and url

    expect(received).toHaveProperty(path, value)

    Expected path: "sessionId"
    Received path: []

    Expected value: "cs_test_456"
    Received value: {"error": "Rate limit exceeded", "limit": 5, "remaining": 0, "resetAt": 1761275604353, "retryAfter": 60}

      394 |       const data = await response.json();
      395 |
    > 396 |       expect(data).toHaveProperty('sessionId', 'cs_test_456');
          |                    ^
      397 |       expect(data).toHaveProperty('url', 'https://checkout.stripe.com/test456');
      398 |     });
      399 |   });

      at Object.toHaveProperty (__tests__/api/payments/checkout.test.ts:396:20)

  ● POST /api/stripe/checkout › URL Configuration › should use NEXT_PUBLIC_BASE_URL when available

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"cancelUrl": "https://example.com/settings", "successUrl": "https://example.com/settings?session_id={CHECKOUT_SESSION_ID}"}

    Number of calls: 0

      421 |       await POST(mockRequest);
      422 |
    > 423 |       expect(createCheckoutSession).toHaveBeenCalledWith(
          |                                     ^
      424 |         expect.objectContaining({
      425 |           successUrl: 'https://example.com/settings?session_id={CHECKOUT_SESSION_ID}',
      426 |           cancelUrl: 'https://example.com/settings',

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:423:37)

  ● POST /api/stripe/checkout › URL Configuration › should fallback to request origin when BASE_URL not set

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"cancelUrl": StringContaining "http://localhost:3000/settings", "successUrl": StringContaining "http://localhost:3000/settings"}

    Number of calls: 0

      450 |       await POST(mockRequest);
      451 |
    > 452 |       expect(createCheckoutSession).toHaveBeenCalledWith(
          |                                     ^
      453 |         expect.objectContaining({
      454 |           successUrl: expect.stringContaining('http://localhost:3000/settings'),
      455 |           cancelUrl: expect.stringContaining('http://localhost:3000/settings'),

      at Object.toHaveBeenCalledWith (__tests__/api/payments/checkout.test.ts:452:37)

FAIL __tests__/api/payments/webhook.test.ts
  ● POST /api/stripe/webhook › Webhook Verification › should verify webhook signature correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      178 |
      179 |       expect(mockConstructEvent).toHaveBeenCalledWith(body, 'valid-signature', 'whsec_test_secret');
    > 180 |       expect(response.status).toBe(200);
          |                               ^
      181 |     });
      182 |   });
      183 |

      at Object.toBe (__tests__/api/payments/webhook.test.ts:180:31)

  ● POST /api/stripe/webhook › checkout.session.completed Event › should upgrade user to premium on successful checkout

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      222 |       const response = await POST(mockRequest);
      223 |
    > 224 |       expect(response.status).toBe(200);
          |                               ^
      225 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      226 |         expect.objectContaining({
      227 |           tier: 'premium',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:224:31)

  ● POST /api/stripe/webhook › checkout.session.completed Event › should preserve admin tier on checkout

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      268 |       const response = await POST(mockRequest);
      269 |
    > 270 |       expect(response.status).toBe(200);
          |                               ^
      271 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      272 |         expect.objectContaining({
      273 |           tier: 'admin', // Should remain admin

      at Object.toBe (__tests__/api/payments/webhook.test.ts:270:31)

  ● POST /api/stripe/webhook › customer.subscription.updated Event › should update subscription status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      393 |       const response = await POST(mockRequest);
      394 |
    > 395 |       expect(response.status).toBe(200);
          |                               ^
      396 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      397 |         expect.objectContaining({
      398 |           subscription_status: 'active',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:395:31)

  ● POST /api/stripe/webhook › customer.subscription.updated Event › should downgrade to free when subscription becomes inactive

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      436 |       const response = await POST(mockRequest);
      437 |
    > 438 |       expect(response.status).toBe(200);
          |                               ^
      439 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      440 |         expect.objectContaining({
      441 |           tier: 'free',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:438:31)

  ● POST /api/stripe/webhook › customer.subscription.updated Event › should preserve admin tier on subscription update

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tier": "admin"}

    Number of calls: 0

      478 |       const response = await POST(mockRequest);
      479 |
    > 480 |       expect(mockSupabase.update).toHaveBeenCalledWith(
          |                                   ^
      481 |         expect.objectContaining({
      482 |           tier: 'admin',
      483 |         })

      at Object.toHaveBeenCalledWith (__tests__/api/payments/webhook.test.ts:480:35)

  ● POST /api/stripe/webhook › customer.subscription.deleted Event › should downgrade user to free tier

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      520 |       const response = await POST(mockRequest);
      521 |
    > 522 |       expect(response.status).toBe(200);
          |                               ^
      523 |       expect(mockSupabase.update).toHaveBeenCalledWith(
      524 |         expect.objectContaining({
      525 |           tier: 'free',

      at Object.toBe (__tests__/api/payments/webhook.test.ts:522:31)

  ● POST /api/stripe/webhook › customer.subscription.deleted Event › should preserve admin tier on subscription deletion

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: ObjectContaining {"tier": "admin"}

    Number of calls: 0

      564 |       const response = await POST(mockRequest);
      565 |
    > 566 |       expect(mockSupabase.update).toHaveBeenCalledWith(
          |                                   ^
      567 |         expect.objectContaining({
      568 |           tier: 'admin',
      569 |         })

      at Object.toHaveBeenCalledWith (__tests__/api/payments/webhook.test.ts:566:35)

FAIL __tests__/api/video/status.test.ts
  ● GET /api/video/status › Authentication › should return 401 when user is not authenticated

    expect(received).toBe(expected) // Object.is equality

    Expected: 401
    Received: 500

       95 |       const response = await GET(mockRequest);
       96 |
    >  97 |       expect(response.status).toBe(401);
          |                               ^
       98 |     });
       99 |
      100 |     it('should return 429 when rate limit exceeded', async () => {

      at Object.toBe (__tests__/api/video/status.test.ts:97:31)

  ● GET /api/video/status › Authentication › should return 429 when rate limit exceeded

    expect(received).toBe(expected) // Object.is equality

    Expected: 429
    Received: 500

      113 |       const response = await GET(mockRequest);
      114 |
    > 115 |       expect(response.status).toBe(429);
          |                               ^
      116 |       const body = await response.json();
      117 |       expect(body.error).toBe('Rate limit exceeded');
      118 |     });

      at Object.toBe (__tests__/api/video/status.test.ts:115:31)

  ● GET /api/video/status › FAL Video Status › should check FAL operation status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      158 |       const response = await GET(mockRequest);
      159 |
    > 160 |       expect(response.status).toBe(200);
          |                               ^
      161 |       expect(checkFalVideoStatus).toHaveBeenCalledWith('request-123', 'seedance-1.0-pro');
      162 |       const data = await response.json();
      163 |       expect(data.done).toBe(false);

      at Object.toBe (__tests__/api/video/status.test.ts:160:31)

  ● GET /api/video/status › Veo Video Status › should check Veo operation status

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      258 |       const response = await GET(mockRequest);
      259 |
    > 260 |       expect(response.status).toBe(200);
          |                               ^
      261 |       expect(checkOperationStatus).toHaveBeenCalledWith('operations/veo-123');
      262 |       const data = await response.json();
      263 |       expect(data.done).toBe(false);

      at Object.toBe (__tests__/api/video/status.test.ts:260:31)

  ● GET /api/video/status › Veo Video Status › should download Veo video from GCS URI

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 500

      355 |       const response = await GET(mockRequest);
      356 |
    > 357 |       expect(response.status).toBe(200);
          |                               ^
      358 |       const data = await response.json();
      359 |       expect(data.done).toBe(true);
      360 |

      at Object.toBe (__tests__/api/video/status.test.ts:357:31)

FAIL __tests__/api/image/generate.test.ts
  ● Test suite failed to run

    Jest encountered an unexpected token

    Jest failed to parse a file. This happens e.g. when your code or its dependencies use non-standard JavaScript syntax, or when Jest is not configured to support such syntax.

    Out of the box Jest supports Babel, which will be used to transform your files into valid JS based on your Babel configuration.

    By default "node_modules" folder is ignored by transformers.

    Here's what you can do:
     • If you are trying to use ECMAScript Modules, see https://jestjs.io/docs/ecmascript-modules for how to enable it.
     • If you are trying to use TypeScript, see https://jestjs.io/docs/getting-started#using-typescript
     • To have some of your "node_modules" files transformed, you can specify a custom "transformIgnorePatterns" in your config.
     • If you need a custom transformation, specify a "transform" option in your config.
     • If you simply want to mock your non-JS modules (e.g. binary assets) you can stub them out with the "moduleNameMapper" config option.

    You'll find more details and examples of these config options in the docs:
    https://jestjs.io/docs/configuration
    For information about custom transformations, see:
    https://jestjs.io/docs/code-transformation

    Details:

    /Users/davidchen/Projects/non-linear-editor/node_modules/uuid/dist-node/index.js:1
    export { default as MAX } from './max.js';
    ^^^^^^

    SyntaxError: Unexpected token 'export'

      14 |   validatePersonGeneration,
      15 |   validateAll,
    > 16 | } from '@/lib/api/validation';
         |               ^
      17 | import {
      18 |   unauthorizedResponse,
      19 |   rateLimitResponse,

      at Runtime.createScriptFromCode (node_modules/jest-runtime/build/index.js:1318:40)
      at Object.<anonymous> (app/api/image/generate/route.ts:16:15)
      at Object.<anonymous> (__tests__/api/image/generate.test.ts:71:16)

FAIL __tests__/helpers/supabase.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/helpers/mocks.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/helpers/api.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/helpers/index.ts
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/components/CreateProjectButton.test.tsx
  ● Test suite failed to run

    Cannot find module 'tailwind-merge' from 'lib/utils.ts'

    Require stack:
      lib/utils.ts
      components/ui/Button.tsx
      components/CreateProjectButton.tsx
      __tests__/components/CreateProjectButton.test.tsx



      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/index.js:863:11)
      at Object.<anonymous> (lib/utils.ts:12:24)
      at Object.<anonymous> (components/ui/Button.tsx:13:16)
      at Object.<anonymous> (components/CreateProjectButton.tsx:24:17)
      at Object.<anonymous> (__tests__/components/CreateProjectButton.test.tsx:28:30)

FAIL __tests__/components/HorizontalTimeline.test.tsx
  ● Test suite failed to run

    Cannot find module 'tailwind-merge' from 'lib/utils.ts'

    Require stack:
      lib/utils.ts
      components/ui/Button.tsx
      components/timeline/TimelineControls.tsx
      components/HorizontalTimeline.tsx
      __tests__/components/HorizontalTimeline.test.tsx



      at Resolver._throwModNotFoundError (node_modules/jest-resolve/build/index.js:863:11)
      at Object.<anonymous> (lib/utils.ts:12:24)
      at Object.<anonymous> (components/ui/Button.tsx:13:16)
      at Object.<anonymous> (components/timeline/TimelineControls.tsx:16:17)
      at Object.<anonymous> (components/HorizontalTimeline.tsx:28:27)
      at Object.<anonymous> (__tests__/components/HorizontalTimeline.test.tsx:11:68)

FAIL __tests__/helpers/components.tsx
  ● Test suite failed to run

    Your test suite must contain at least one test.

      at onResult (node_modules/@jest/core/build/index.js:1057:18)
      at node_modules/@jest/core/build/index.js:1127:165
      at node_modules/emittery/index.js:363:13
          at Array.map (<anonymous>)
      at Emittery.emit (node_modules/emittery/index.js:361:23)

FAIL __tests__/components/PreviewPlayer.test.tsx
  ● PreviewPlayer › should display current time and total duration

    TestingLibraryElementError: Unable to find an element with the text: /00:05:15/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"relative flex h-full flex-col"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"absolute inset-0"[39m
            [36m/>[39m
            [36m<div[39m
              [33mdata-testid[39m=[32m"playback-controls"[39m
            [36m>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Play (Space)"[39m
              [36m>[39m
                [0mPlay[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Enter fullscreen"[39m
              [36m>[39m
                [0mFullscreen[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Hide controls"[39m
              [36m>[39m
                [0mHide[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      246 |
      247 |     // Should show timecode (MM:SS:FF format)
    > 248 |     expect(screen.getByText(/00:05:15/)).toBeInTheDocument(); // 5.5 seconds
          |                   ^
      249 |   });
      250 |
      251 |   it('should toggle play/pause when clicking play button', async () => {

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (__tests__/components/PreviewPlayer.test.tsx:248:19)

  ● PreviewPlayer › should display progress bar

    expect(received).toBeInTheDocument()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

      278 |     // Find progress bar
      279 |     const progressBar = container.querySelector('.bg-white.transition-all');
    > 280 |     expect(progressBar).toBeInTheDocument();
          |                         ^
      281 |   });
      282 |
      283 |   it('should calculate progress correctly', () => {

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:2240:22)
      at Object.throwingMatcher [as toBeInTheDocument] (node_modules/expect/build/index.js:2241:6)
      at Object.toBeInTheDocument (__tests__/components/PreviewPlayer.test.tsx:280:25)

  ● PreviewPlayer › should calculate progress correctly

    expect(received).toHaveStyle()

    received value must be an HTMLElement or an SVGElement.
    Received has value: null

      297 |
      298 |     const progressBar = container.querySelector('.bg-white.transition-all') as HTMLElement;
    > 299 |     expect(progressBar).toHaveStyle({ width: '50%' });
          |                         ^
      300 |   });
      301 |
      302 |   it('should render text overlay editor when present and not playing', () => {

      at __EXTERNAL_MATCHER_TRAP__ (node_modules/expect/build/index.js:2240:22)
      at Object.throwingMatcher [as toHaveStyle] (node_modules/expect/build/index.js:2241:6)
      at Object.toHaveStyle (__tests__/components/PreviewPlayer.test.tsx:299:25)

  ● PreviewPlayer › should toggle fullscreen on button click

    expect(jest.fn()).toHaveBeenCalled()

    Expected number of calls: >= 1
    Received number of calls:    0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex h-full flex-col"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"absolute inset-0"[39m
              [36m/>[39m
              [36m<div[39m
                [33mdata-testid[39m=[32m"playback-controls"[39m
              [36m>[39m
                [36m<button[39m
                  [33mtitle[39m=[32m"Play (Space)"[39m
                [36m>[39m
                  [0mPlay[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mtitle[39m=[32m"Enter fullscreen"[39m
                [36m>[39m
                  [0mFullscreen[0m
                [36m</button>[39m
                [36m<button[39m
                  [33mtitle[39m=[32m"Hide controls"[39m
                [36m>[39m
                  [0mHide[0m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      357 |
      358 |     await waitFor(() => {
    > 359 |       expect(mockRequestFullscreen).toHaveBeenCalled();
          |                                     ^
      360 |     });
      361 |   });
      362 |

      at toHaveBeenCalled (__tests__/components/PreviewPlayer.test.tsx:359:37)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● PreviewPlayer › should handle keyboard spacebar to toggle play/pause

    Unable to find an element with the title: Pause (Space).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"relative flex h-full flex-col"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"absolute inset-0"[39m
            [36m/>[39m
            [36m<div[39m
              [33mdata-testid[39m=[32m"playback-controls"[39m
            [36m>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Play (Space)"[39m
              [36m>[39m
                [0mPlay[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Enter fullscreen"[39m
              [36m>[39m
                [0mFullscreen[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Hide controls"[39m
              [36m>[39m
                [0mHide[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      397 |     fireEvent.keyDown(window, { code: 'Space', target: document.body });
      398 |
    > 399 |     await waitFor(() => {
          |                  ^
      400 |       expect(screen.getByTitle('Pause (Space)')).toBeInTheDocument();
      401 |     });
      402 |   });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/PreviewPlayer.test.tsx:399:18)

  ● PreviewPlayer › should show timecode in MM:SS:FF format

    TestingLibraryElementError: Unable to find an element with the text: /02:05:15/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"relative flex h-full flex-col"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"relative flex-1 overflow-hidden rounded-xl bg-black"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"absolute inset-0"[39m
            [36m/>[39m
            [36m<div[39m
              [33mdata-testid[39m=[32m"playback-controls"[39m
            [36m>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Play (Space)"[39m
              [36m>[39m
                [0mPlay[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Enter fullscreen"[39m
              [36m>[39m
                [0mFullscreen[0m
              [36m</button>[39m
              [36m<button[39m
                [33mtitle[39m=[32m"Hide controls"[39m
              [36m>[39m
                [0mHide[0m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      437 |
      438 |     // 125.5 seconds = 02:05:15 (2 minutes, 5 seconds, 15 frames)
    > 439 |     expect(screen.getByText(/02:05:15/)).toBeInTheDocument();
          |                   ^
      440 |   });
      441 |
      442 |   it('should handle clips with transitions', () => {

      at Object.getElementError (node_modules/@testing-library/dom/dist/config.js:37:19)
      at node_modules/@testing-library/dom/dist/query-helpers.js:76:38
      at node_modules/@testing-library/dom/dist/query-helpers.js:52:17
      at node_modules/@testing-library/dom/dist/query-helpers.js:95:19
      at Object.getByText (__tests__/components/PreviewPlayer.test.tsx:439:19)

FAIL __tests__/components/ActivityHistory.test.tsx
  ● ActivityHistory › Relative Time Display › should display formatted date for old activities

    Found multiple elements with the text: (content, element)=>{
                        return element?.className.includes('whitespace-nowrap') && content.length > 0;
                    }

    Here are the matching elements:

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
    [36m>[39m
      [0m1 hour ago[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
    [36m>[39m
      [0m1 day ago[0m
    [36m</span>[39m

    Ignored nodes: comments, script, style
    [36m<span[39m
      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
    [36m>[39m
      [0mOct 16[0m
    [36m</span>[39m

    (If this is intentional, then use the `*AllBy*` variant of the query (like `queryAllByText`, `getAllByText`, or `findAllByText`)).

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-xl border border-neutral-200 bg-white p-6 shadow-sm"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-4 flex items-center justify-between"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-xl font-semibold text-neutral-900"[39m
            [36m>[39m
              [0mActivity History[0m
            [36m</h2>[39m
            [36m<button[39m
              [33mclass[39m=[32m"rounded-lg bg-neutral-100 px-3 py-1.5 text-xs font-medium text-neutral-700 hover:bg-neutral-200 disabled:cursor-not-allowed disabled:opacity-50"[39m
            [36m>[39m
              [0mClear History[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-h-96 overflow-y-auto"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m��[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mEpic Sci-Fi Scene[0m
                      [36m</h3>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-600 line-clamp-2"[39m
                      [36m>[39m
                        [0mA futuristic cityscape with flying cars[0m
                      [36m</p>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-500"[39m
                      [36m>[39m
                        [0mModel: [0m
                        [0mveo-2.0[0m
                      [36m</p>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m8[0m
                          [0ms[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m1080p[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m16:9[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0m1 hour ago[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m��[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mBackground Music[0m
                      [36m</h3>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-600 line-clamp-2"[39m
                      [36m>[39m
                        [0mAmbient electronic track[0m
                      [36m</p>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-500"[39m
                      [36m>[39m
                        [0mModel: [0m
                        [0melevenlabs-music[0m
                      [36m</p>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m30[0m
                          [0ms[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0m1 day ago[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m��[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mVideo Uploaded[0m
                      [36m</h3>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m50.0[0m
                          [0m MB[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0mOct 16[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"pt-2 text-center text-xs text-neutral-500"[39m
            [36m>[39m
              [0mShowing [0m
              [0m3[0m
              [0m [0m
              [0mentries[0m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      255 |     it('should display formatted date for old activities', async () => {
      256 |       render(<ActivityHistory />);
    > 257 |       await waitFor(() => {
          |                    ^
      258 |         const timeText = screen.getByText((content, element) => {
      259 |           return element?.className.includes('whitespace-nowrap') && content.length > 0;
      260 |         });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/ActivityHistory.test.tsx:257:20)

  ● ActivityHistory › Activity Types › should handle unknown activity type

    Unable to find an element with the text: Activity. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"rounded-xl border border-neutral-200 bg-white p-6 shadow-sm"[39m
        [36m>[39m
          [36m<div[39m
            [33mclass[39m=[32m"mb-4 flex items-center justify-between"[39m
          [36m>[39m
            [36m<h2[39m
              [33mclass[39m=[32m"text-xl font-semibold text-neutral-900"[39m
            [36m>[39m
              [0mActivity History[0m
            [36m</h2>[39m
            [36m<button[39m
              [33mclass[39m=[32m"rounded-lg bg-neutral-100 px-3 py-1.5 text-xs font-medium text-neutral-700 hover:bg-neutral-200 disabled:cursor-not-allowed disabled:opacity-50"[39m
            [36m>[39m
              [0mClear History[0m
            [36m</button>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"max-h-96 overflow-y-auto"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-start gap-3 rounded-lg border border-neutral-100 p-3 hover:bg-neutral-50 transition-colors"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-2xl flex-shrink-0"[39m
                [36m>[39m
                  [0m��[0m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex-1 min-w-0"[39m
                [36m>[39m
                  [36m<div[39m
                    [33mclass[39m=[32m"flex items-start justify-between gap-2"[39m
                  [36m>[39m
                    [36m<div[39m
                      [33mclass[39m=[32m"flex-1 min-w-0"[39m
                    [36m>[39m
                      [36m<h3[39m
                        [33mclass[39m=[32m"text-sm font-medium text-neutral-900 truncate"[39m
                      [36m>[39m
                        [0mEpic Sci-Fi Scene[0m
                      [36m</h3>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-600 line-clamp-2"[39m
                      [36m>[39m
                        [0mA futuristic cityscape with flying cars[0m
                      [36m</p>[39m
                      [36m<p[39m
                        [33mclass[39m=[32m"mt-0.5 text-xs text-neutral-500"[39m
                      [36m>[39m
                        [0mModel: [0m
                        [0mveo-2.0[0m
                      [36m</p>[39m
                      [36m<div[39m
                        [33mclass[39m=[32m"mt-1 flex flex-wrap gap-2"[39m
                      [36m>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m8[0m
                          [0ms[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m1080p[0m
                        [36m</span>[39m
                        [36m<span[39m
                          [33mclass[39m=[32m"inline-flex items-center rounded-full bg-neutral-100 px-2 py-0.5 text-xs text-neutral-700"[39m
                        [36m>[39m
                          [0m16:9[0m
                        [36m</span>[39m
                      [36m</div>[39m
                    [36m</div>[39m
                    [36m<span[39m
                      [33mclass[39m=[32m"text-xs text-neutral-500 whitespace-nowrap"[39m
                    [36m>[39m
                      [0m1 hour ago[0m
                    [36m</span>[39m
                  [36m</div>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"pt-2 text-center text-xs text-neutral-500"[39m
            [36m>[39m
              [0mShowing [0m
              [0m1[0m
              [0m [0m
              [0mentry[0m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      500 |       render(<ActivityHistory />);
      501 |
    > 502 |       await waitFor(() => {
          |                    ^
      503 |         expect(screen.getByText('��')).toBeInTheDocument();
      504 |         expect(screen.getByText('Activity')).toBeInTheDocument();
      505 |       });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/ActivityHistory.test.tsx:502:20)

FAIL __tests__/components/editor/ChatBox.test.tsx (8.291 s)
  ● ChatBox › Message Display › should display messages after loading

    Unable to find an element with the text: Hello, can you help me?. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      222 |     it('should display messages after loading', async () => {
      223 |       render(<ChatBox {...defaultProps} />);
    > 224 |       await waitFor(() => {
          |                    ^
      225 |         expect(screen.getByText('Hello, can you help me?')).toBeInTheDocument();
      226 |         expect(screen.getByText('Of course! How can I assist you today?')).toBeInTheDocument();
      227 |       });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:224:20)

  ● ChatBox › Message Display › should display message timestamps

    Unable to find an element with the text: /\d{1,2}:\d{2}/. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      240 |     it('should display message timestamps', async () => {
      241 |       render(<ChatBox {...defaultProps} />);
    > 242 |       await waitFor(() => {
          |                    ^
      243 |         const timestamps = screen.getAllByText(/\d{1,2}:\d{2}/);
      244 |         expect(timestamps.length).toBeGreaterThan(0);
      245 |       });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:242:20)

  ● ChatBox › Message Display › should style user messages differently from assistant messages

    expect(received).toBeGreaterThan(expected)

    Expected: > 0
    Received:   0

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
          [36m>[39m
            [36m<input[39m
              [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
              [33mclass[39m=[32m"hidden"[39m
              [33mmultiple[39m=[32m""[39m
              [33mtype[39m=[32m"file"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-3"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
                [36m>[39m
                  [0mDreamReal Assistant[0m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-flash-latest"[39m
                  [36m>[39m
                    [0mGemini Flash[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                  [36m>[39m
                    [0mGemini Pro[0m
                  [36m</option>[39m
                [36m</select>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Clear chat history"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                  [33mtitle[39m=[32m"Clear chat history"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
                [36m>[39m
                  [0mStart a conversation[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
                [36m>[39m
                  [0mAsk me anything about your video project[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div />[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex gap-2"[39m
              [36m>[39m
                [36m<textarea[39m
                  [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                  [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                  [33mrows[39m=[32m"2"[39m
                [36m/>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex flex-col gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Send message"[39m
                    [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                    [33mdisabled[39m=[32m""[39m
                    [33mtitle[39m=[32m"Send message"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Attach files"[39m
                    [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                    [33mtitle[39m=[32m"Attach files"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      252 |         const assistantMessages = container.querySelectorAll('.bg-neutral-100');
      253 |         expect(userMessages.length).toBeGreaterThan(0);
    > 254 |         expect(assistantMessages.length).toBeGreaterThan(0);
          |                                          ^
      255 |       });
      256 |     });
      257 |   });

      at toBeGreaterThan (__tests__/components/editor/ChatBox.test.tsx:254:42)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● ChatBox › Message Sending › should send message on button click

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: "/api/ai/chat", Any<Object>
    Received
           1: "/api/projects/test-project/chat"
           2: "/api/projects/test-project/chat/messages", {"body": "{\"role\":\"user\",\"content\":\"Test message\",\"model\":\"gemini-flash-latest\",\"attachments\":null}", "headers": {"Content-Type": "application/json"}, "method": "POST"}

    Number of calls: 2

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
          [36m>[39m
            [36m<input[39m
              [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
              [33mclass[39m=[32m"hidden"[39m
              [33mmultiple[39m=[32m""[39m
              [33mtype[39m=[32m"file"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-3"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
                [36m>[39m
                  [0mDreamReal Assistant[0m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-flash-latest"[39m
                  [36m>[39m
                    [0mGemini Flash[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                  [36m>[39m
                    [0mGemini Pro[0m
                  [36m</option>[39m
                [36m</select>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Clear chat history"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                  [33mtitle[39m=[32m"Clear chat history"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
                [36m>[39m
                  [0mStart a conversation[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
                [36m>[39m
                  [0mAsk me anything about your video project[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div />[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex gap-2"[39m
              [36m>[39m
                [36m<textarea[39m
                  [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                  [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                  [33mrows[39m=[32m"2"[39m
                [36m>[39m
                  [0mTest message[0m
                [36m</textarea>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex flex-col gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Send message"[39m
                    [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                    [33mtitle[39m=[32m"Send message"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Attach files"[39m
                    [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                    [33mtitle[39m=[32m"Attach files"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      332 |       await user.click(sendButton);
      333 |       await waitFor(() => {
    > 334 |         expect(global.fetch).toHaveBeenCalledWith('/api/ai/chat', expect.any(Object));
          |                              ^
      335 |       });
      336 |     });
      337 |

      at toHaveBeenCalledWith (__tests__/components/editor/ChatBox.test.tsx:334:30)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● ChatBox › Message Sending › should send message on Enter key press

    expect(element).toHaveValue()

    Expected the element to have value:

    Received:
      Test message

    Ignored nodes: comments, script, style
    [36m<html>[39m
      [36m<head />[39m
      [36m<body>[39m
        [36m<div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
          [36m>[39m
            [36m<input[39m
              [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
              [33mclass[39m=[32m"hidden"[39m
              [33mmultiple[39m=[32m""[39m
              [33mtype[39m=[32m"file"[39m
            [36m/>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-3"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
                [36m>[39m
                  [0mDreamReal Assistant[0m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2"[39m
              [36m>[39m
                [36m<select[39m
                  [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [36m>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-flash-latest"[39m
                  [36m>[39m
                    [0mGemini Flash[0m
                  [36m</option>[39m
                  [36m<option[39m
                    [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                  [36m>[39m
                    [0mGemini Pro[0m
                  [36m</option>[39m
                [36m</select>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Clear chat history"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                  [33mtitle[39m=[32m"Clear chat history"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
              [36m>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</div>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
                [36m>[39m
                  [0mStart a conversation[0m
                [36m</p>[39m
                [36m<p[39m
                  [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
                [36m>[39m
                  [0mAsk me anything about your video project[0m
                [36m</p>[39m
              [36m</div>[39m
              [36m<div />[39m
            [36m</div>[39m
            [36m<div[39m
              [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex gap-2"[39m
              [36m>[39m
                [36m<textarea[39m
                  [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                  [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                  [33mrows[39m=[32m"2"[39m
                [36m>[39m
                  [0mTest message[0m
                [36m</textarea>[39m
                [36m<div[39m
                  [33mclass[39m=[32m"flex flex-col gap-2"[39m
                [36m>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Send message"[39m
                    [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                    [33mtitle[39m=[32m"Send message"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                  [36m<button[39m
                    [33maria-label[39m=[32m"Attach files"[39m
                    [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                    [33mtitle[39m=[32m"Attach files"[39m
                  [36m>[39m
                    [36m<svg[39m
                      [33mclass[39m=[32m"h-4 w-4"[39m
                      [33mfill[39m=[32m"none"[39m
                      [33mstroke[39m=[32m"currentColor"[39m
                      [33mviewBox[39m=[32m"0 0 24 24"[39m
                    [36m>[39m
                      [36m<path[39m
                        [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                        [33mstroke-linecap[39m=[32m"round"[39m
                        [33mstroke-linejoin[39m=[32m"round"[39m
                        [33mstroke-width[39m=[32m"2"[39m
                      [36m/>[39m
                    [36m</svg>[39m
                  [36m</button>[39m
                [36m</div>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</body>[39m
    [36m</html>[39m

      349 |       // Message should be cleared after sending
      350 |       await waitFor(() => {
    > 351 |         expect(input).toHaveValue('');
          |                       ^
      352 |       });
      353 |     });
      354 |

      at toHaveValue (__tests__/components/editor/ChatBox.test.tsx:351:23)
      at runWithExpensiveErrorDiagnosticsDisabled (node_modules/@testing-library/dom/dist/config.js:47:12)
      at checkCallback (node_modules/@testing-library/dom/dist/wait-for.js:124:77)
      at checkRealTimersCallback (node_modules/@testing-library/dom/dist/wait-for.js:118:16)
      at Timeout.task [as _onTimeout] (node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  ● ChatBox › File Attachments › should create blob URLs when files are attached

    expect(jest.fn()).toHaveBeenCalledWith(...expected)

    Expected: {}

    Number of calls: 0

      407 |       });
      408 |
    > 409 |       expect(mockCreateObjectURL).toHaveBeenCalledWith(testFile);
          |                                   ^
      410 |       await waitFor(() => {
      411 |         expect(screen.getByText('test.png')).toBeInTheDocument();
      412 |       });

      at Object.toHaveBeenCalledWith (__tests__/components/editor/ChatBox.test.tsx:409:35)

  ● ChatBox › Clear Chat › should not clear chat if user cancels

    Unable to find an element with the text: Hello, can you help me?. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m/>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mdisabled[39m=[32m""[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      483 |
      484 |       // Messages should still be present
    > 485 |       await waitFor(() => {
          |                    ^
      486 |         expect(screen.getByText('Hello, can you help me?')).toBeInTheDocument();
      487 |       });
      488 |     });

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:485:20)

  ● ChatBox › Loading States › should show loading indicator when sending message

    Unable to find an element with the text: (content, element)=>{ return element?.className.includes('animate-bounce') ?? false; } (normalized from '(content, element)=>{
                        return element?.className.includes('animate-bounce') ?? false;
                    }'), which matches selector 'div'. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center justify-center py-8"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex items-center gap-2 text-sm text-neutral-500"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 animate-spin"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<circle[39m
                    [33mclass[39m=[32m"opacity-25"[39m
                    [33mcx[39m=[32m"12"[39m
                    [33mcy[39m=[32m"12"[39m
                    [33mr[39m=[32m"10"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mstroke-width[39m=[32m"4"[39m
                  [36m/>[39m
                  [36m<path[39m
                    [33mclass[39m=[32m"opacity-75"[39m
                    [33md[39m=[32m"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"[39m
                    [33mfill[39m=[32m"currentColor"[39m
                  [36m/>[39m
                [36m</svg>[39m
                [0mLoading...[0m
              [36m</div>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m>[39m
                [0mTest message[0m
              [36m</textarea>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      519 |
      520 |       // Should show loading dots
    > 521 |       await waitFor(
          |                    ^
      522 |         () => {
      523 |           const loadingDots = screen.getByText(
      524 |             (content, element) => {

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:521:20)

  ● ChatBox › Error Handling › should display error message when API fails

    Unable to find an element with the text: Sorry, I encountered an error processing your request.. This could be because the text is broken up by multiple elements. In this case, you can provide a function for your text matcher to make your matcher more flexible.

    Ignored nodes: comments, script, style
    [36m<body>[39m
      [36m<div>[39m
        [36m<div[39m
          [33mclass[39m=[32m"flex h-full flex-col border-l border-neutral-200 bg-white"[39m
        [36m>[39m
          [36m<input[39m
            [33maccept[39m=[32m"image/*,.pdf,.doc,.docx,.txt"[39m
            [33mclass[39m=[32m"hidden"[39m
            [33mmultiple[39m=[32m""[39m
            [33mtype[39m=[32m"file"[39m
          [36m/>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex items-center justify-between border-b border-neutral-200 px-6 py-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-3"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex h-8 w-8 items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-purple-600"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4 text-white"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<div[39m
                [33mclass[39m=[32m"text-sm font-semibold text-neutral-900"[39m
              [36m>[39m
                [0mDreamReal Assistant[0m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-b border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex items-center gap-2"[39m
            [36m>[39m
              [36m<select[39m
                [33mclass[39m=[32m"flex-1 rounded-lg border border-neutral-300 bg-white px-3 py-2 text-xs font-medium text-neutral-700 focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
              [36m>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-flash-latest"[39m
                [36m>[39m
                  [0mGemini Flash[0m
                [36m</option>[39m
                [36m<option[39m
                  [33mvalue[39m=[32m"gemini-2.5-pro"[39m
                [36m>[39m
                  [0mGemini Pro[0m
                [36m</option>[39m
              [36m</select>[39m
              [36m<button[39m
                [33maria-label[39m=[32m"Clear chat history"[39m
                [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50 hover:text-red-600 transition-colors"[39m
                [33mtitle[39m=[32m"Clear chat history"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-4 w-4"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</button>[39m
            [36m</div>[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"flex-1 overflow-y-auto p-4 space-y-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex flex-col items-center justify-center py-12 text-center"[39m
            [36m>[39m
              [36m<div[39m
                [33mclass[39m=[32m"mb-3 flex h-12 w-12 items-center justify-center rounded-full bg-gradient-to-br from-blue-100 to-purple-100"[39m
              [36m>[39m
                [36m<svg[39m
                  [33mclass[39m=[32m"h-6 w-6 text-blue-600"[39m
                  [33mfill[39m=[32m"none"[39m
                  [33mstroke[39m=[32m"currentColor"[39m
                  [33mviewBox[39m=[32m"0 0 24 24"[39m
                [36m>[39m
                  [36m<path[39m
                    [33md[39m=[32m"M13 10V3L4 14h7v7l9-11h-7z"[39m
                    [33mstroke-linecap[39m=[32m"round"[39m
                    [33mstroke-linejoin[39m=[32m"round"[39m
                    [33mstroke-width[39m=[32m"2"[39m
                  [36m/>[39m
                [36m</svg>[39m
              [36m</div>[39m
              [36m<p[39m
                [33mclass[39m=[32m"text-sm font-medium text-neutral-900"[39m
              [36m>[39m
                [0mStart a conversation[0m
              [36m</p>[39m
              [36m<p[39m
                [33mclass[39m=[32m"mt-1 text-xs text-neutral-500"[39m
              [36m>[39m
                [0mAsk me anything about your video project[0m
              [36m</p>[39m
            [36m</div>[39m
            [36m<div />[39m
          [36m</div>[39m
          [36m<div[39m
            [33mclass[39m=[32m"border-t border-neutral-200 p-3"[39m
          [36m>[39m
            [36m<div[39m
              [33mclass[39m=[32m"flex gap-2"[39m
            [36m>[39m
              [36m<textarea[39m
                [33mclass[39m=[32m"flex-1 resize-none rounded-lg border border-neutral-300 bg-white px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-500/20"[39m
                [33mplaceholder[39m=[32m"Ask about your video project..."[39m
                [33mrows[39m=[32m"2"[39m
              [36m>[39m
                [0mTest message[0m
              [36m</textarea>[39m
              [36m<div[39m
                [33mclass[39m=[32m"flex flex-col gap-2"[39m
              [36m>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Send message"[39m
                  [33mclass[39m=[32m"rounded-lg bg-gradient-to-br from-blue-600 to-blue-700 p-2 text-white hover:from-blue-700 hover:to-blue-800 disabled:opacity-50"[39m
                  [33mtitle[39m=[32m"Send message"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
                [36m<button[39m
                  [33maria-label[39m=[32m"Attach files"[39m
                  [33mclass[39m=[32m"rounded-lg border border-neutral-300 bg-white p-2 text-neutral-600 hover:bg-neutral-50"[39m
                  [33mtitle[39m=[32m"Attach files"[39m
                [36m>[39m
                  [36m<svg[39m
                    [33mclass[39m=[32m"h-4 w-4"[39m
                    [33mfill[39m=[32m"none"[39m
                    [33mstroke[39m=[32m"currentColor"[39m
                    [33mviewBox[39m=[32m"0 0 24 24"[39m
                  [36m>[39m
                    [36m<path[39m
                      [33md[39m=[32m"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"[39m
                      [33mstroke-linecap[39m=[32m"round"[39m
                      [33mstroke-linejoin[39m=[32m"round"[39m
                      [33mstroke-width[39m=[32m"2"[39m
                    [36m/>[39m
                  [36m</svg>[39m
                [36m</button>[39m
              [36m</div>[39m
            [36m</div>[39m
          [36m</div>[39m
        [36m</div>[39m
      [36m</div>[39m
    [36m</body>[39m

      554 |       await user.click(sendButton);
      555 |
    > 556 |       await waitFor(() => {
          |                    ^
      557 |         expect(
      558 |           screen.getByText('Sorry, I encountered an error processing your request.')
      559 |         ).toBeInTheDocument();

      at waitForWrapper (node_modules/@testing-library/dom/dist/wait-for.js:163:27)
      at Object.<anonymous> (__tests__/components/editor/ChatBox.test.tsx:556:20)


Test Suites: 23 failed, 24 passed, 47 total
Tests:       114 failed, 2 skipped, 768 passed, 884 total
Snapshots:   2 passed, 2 total
Time:        10.105 s
Ran all test suites.
